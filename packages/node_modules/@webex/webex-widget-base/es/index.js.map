{"version":3,"file":"index.js","sources":["../src/enhancers/withRemoveWidget.js","../src/enhancers/withInitialState.js","../src/enhancers/withBrowserGlobals.js","../src/enhancers/withDataAPI.js","../src/enhancers/withIntl.js","../src/enhancers/withCurrentUser.js","../../../../../node_modules/style-inject/dist/style-inject.es.js","../src/index.js"],"sourcesContent":["import {bindActionCreators} from 'redux';\nimport {connect} from 'react-redux';\nimport {compose} from 'recompose';\n\nimport {setWrappedDisplayName} from '@webex/react-component-utils';\n\nexport const REMOVE_WIDGET = 'widget-base/REMOVE_WIDGET';\nexport function removeWidget() {\n  return {\n    type: REMOVE_WIDGET\n  };\n}\n\nexport default compose(\n  setWrappedDisplayName('WithRemoveWidget'),\n  connect(\n    (state) => state,\n    (dispatch) => bindActionCreators({\n      removeWidget\n    }, dispatch)\n  )\n);\n","import React, {Component} from 'react';\nimport {\n  applyMiddleware,\n  combineReducers,\n  createStore,\n  compose\n} from 'redux';\nimport {Provider} from 'react-redux';\nimport {createLogger} from 'redux-logger';\nimport thunk from 'redux-thunk';\nimport PropTypes from 'prop-types';\nimport sparkReducer from '@webex/react-redux-spark';\nimport usersReducer from '@webex/redux-module-users';\n\nimport {REMOVE_WIDGET} from './withRemoveWidget';\n\nfunction constructReducers(reducers) {\n  const rootReducers = reducers;\n\n  rootReducers.spark = sparkReducer;\n  rootReducers.users = usersReducer;\n  const widgetReducer = combineReducers(rootReducers);\n\n  return (state, action) => {\n    if (action.type === REMOVE_WIDGET) {\n      return undefined;\n    }\n    if (widgetReducer) {\n      return widgetReducer(state, action);\n    }\n\n    return state;\n  };\n}\n\n/**\n * HOC for injecting an initial Redux state from reducers and enhancers\n * @param {Object} options\n * @param {Object} options.reducers object of reducers\n * @returns {Function} creates a wrapped React component\n */\nexport default function withInitialState({reducers = {}}) {\n  // eslint-disable-reason redux devtools extension is required name (https://github.com/zalmoxisus/redux-devtools-extension#usage)\n  // eslint-disable-next-line no-underscore-dangle\n  const devtools = window.__REDUX_DEVTOOLS_EXTENSION__ || (() => (noop) => noop);\n  const middlewares = [thunk];\n\n  if (process.env.NODE_ENV !== 'production') {\n    const logger = createLogger({\n      level: 'info',\n      duration: true,\n      collapsed: false,\n      logErrors: true\n    });\n\n    middlewares.push(logger);\n  }\n\n\n  return (BaseComponent) => {\n    class WithInitialState extends Component {\n      constructor(props) {\n        super(props);\n        this.widgetReducer = constructReducers(reducers);\n        this.store = createStore(this.widgetReducer, compose(\n          applyMiddleware(...middlewares),\n          devtools()\n        ));\n      }\n\n      render() {\n        const {props} = this;\n\n        // Do not inject provider if spark object already exists in props\n        if (props.spark) {\n          return <BaseComponent {...props} />;\n        }\n\n        return (\n          <Provider store={this.store}>\n            <BaseComponent {...props} />\n          </Provider>\n        );\n      }\n    }\n    WithInitialState.propTypes = {\n      spark: PropTypes.object\n    };\n\n    WithInitialState.defaultProps = {\n      spark: undefined\n    };\n\n    return WithInitialState;\n  };\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport uuid from 'uuid';\nimport Events from 'ampersand-events';\n\nfunction formatEventDetails({name, data}) {\n  const [resource, eventName] = name.split(':');\n  const details = {\n    resource,\n    event: eventName,\n    data\n  };\n\n  if (data.actorId) {\n    details.actorId = data.actorId;\n  }\n\n  if (data.action) {\n    details.action = data.action;\n  }\n\n  return details;\n}\n\nfunction BrowserWidget(el) {\n  this.el = el;\n  this.remove = (callback) => new Promise((resolve) => {\n    const id = this.el.getAttribute('data-uuid');\n    // Unmount React Component\n    const removed = ReactDOM.unmountComponentAtNode(el);\n\n    // Remove from widgetStore\n    Reflect.deleteProperty(window.webex.widgetStore, id);\n\n    // Fire callback\n    if (typeof callback === 'function') {\n      return callback(removed);\n    }\n\n    return resolve(removed);\n  });\n\n  function handleEvent(name, data) {\n    if (this.el) {\n      // Don't nest data if the event data object is already constructed\n      const detail = data.data ? data : formatEventDetails({name, data});\n      // Dispatch DOM event\n      const event = new CustomEvent(name, {\n        detail\n      });\n\n      this.el.dispatchEvent(event);\n\n      // Trigger ampersand events\n      this.trigger(name, detail);\n    }\n\n    return this;\n  }\n\n  this.handleEvent = handleEvent;\n  this.version = process.env.REACT_WEBEX_VERSION;\n\n  // Attach event handlers to each widget\n  const widgetFn = {};\n\n  Object.keys(window.webex.widgetFn).forEach((fn) => {\n    const func = window.webex.widgetFn[fn];\n\n    widgetFn[fn] = (options) => {\n      const onEvent = (name, data) => {\n        this.handleEvent(name, data);\n        if (typeof options.onEvent === 'function') {\n          options.onEvent(name, formatEventDetails({name, data}));\n        }\n      };\n\n      return func.call(this, {\n        ...options,\n        onEvent: onEvent.bind(this)\n      });\n    };\n  });\n\n  Object.assign(this, widgetFn);\n\n  return this;\n}\n\n\n/**\n * Takes a DOM element and returns a widget or initializes it as a widget element\n * @param {Element} el\n * @returns {Object}\n */\nfunction getWidget(el) {\n  /**\n   * Creates a new widget object and stores it\n   * @param  {object} widgetEl HTML element where a widget is mounted\n   * @returns {object} widgetObject\n   */\n  function createNewWidget(widgetEl) {\n    Object.assign(BrowserWidget.prototype, Events);\n    const widgetObj = new BrowserWidget(widgetEl);\n\n    const id = uuid.v4();\n\n    // Store ID as attribute on dom element\n    widgetEl.setAttribute('data-uuid', id);\n    window.webex.widgetStore[id] = widgetObj;\n\n    return widgetObj;\n  }\n\n  /**\n   * Retrieves a Widget from global widget store\n   * @param  {object} widgetEl HTML element where a widget is mounted\n   * @returns {object} widgetObject\n   */\n  function selectWidget(widgetEl) {\n    // Check if element exists and is HTML Element\n    if (widgetEl && widgetEl.nodeType === 1) {\n      // Get ID as attribute on dom element\n      const id = widgetEl.getAttribute('data-uuid');\n\n      // Add class\n      widgetEl.classList.add('webex-widget');\n      // Get widget from store if it exists\n      const widgetObj = window.webex.widgetStore[id];\n\n      if (widgetObj) {\n        return widgetObj;\n      }\n\n      // Otherwise create new widget store\n      return createNewWidget(widgetEl);\n    }\n    console.warn('WARNING: webex.widget: No HTML element provided.'); // eslint-disable-line no-console\n\n    return false;\n  }\n\n  return selectWidget(el);\n}\n\n\nfunction setupWidgetNamespace() {\n  if (!window.webex) {\n    window.webex = {};\n  }\n  if (!window.webex.widgetStore) {\n    window.webex.widgetStore = {};\n  }\n  if (!window.webex.widgetFn) {\n    window.webex.widgetFn = {};\n  }\n  if (!window.webex.widget || typeof window.webex.widget !== 'function') {\n    window.webex.widget = getWidget;\n  }\n  // Legacy Support\n  if (!window.ciscospark) {\n    window.ciscospark = window.webex;\n  }\n}\n\n/**\n * HOC that registers widget to browser globals\n * @param {String} name of widget to use\n * @returns {Function}\n */\nexport default function withBrowserGlobals({name}) {\n  // Inject widget into browser globals\n  setupWidgetNamespace();\n  const fnName = `${name}Widget`;\n\n  return (BaseComponent) => {\n    function renderWidget(options) {\n      const {el} = this;\n      const {onEvent, ...otherOptions} = options;\n\n      // Instantiate Component into DOM\n      ReactDOM.render(<BaseComponent onEvent={onEvent} {...otherOptions} />, el);\n\n      return this;\n    }\n\n    // Set up this widget's init process\n    // Allow dev to call window.webex.widget(EL).WIDGETNAME({options});\n    if (typeof window.webex.widgetFn[fnName] === 'function') {\n      // eslint-disable-reason Need to log console warning when widget already registered\n      // eslint-disable-next-line no-console\n      console.warn(`${name} Widget is already registered.`);\n    }\n    else {\n      window.webex.widgetFn[fnName] = renderWidget;\n      // Attach version number statically. This will need to change when we publish widgets independently\n      window.webex.widgetFn[fnName].version = process.env.REACT_WEBEX_VERSION;\n    }\n\n    return BaseComponent;\n  };\n}\n","import {\n  camelCase,\n  kebabCase\n} from 'lodash';\n\nfunction getDataAttributes(el) {\n  const data = {};\n\n  if (el) {\n    const attribs = el.attributes;\n\n    for (let i = 0; i < attribs.length; i += 1) {\n      const {name} = attribs[i];\n      const {value} = attribs[i];\n\n      if (name.startsWith('data-') && name !== 'data-toggle') {\n        data[camelCase(name.replace('data-', ''))] = value;\n      }\n    }\n  }\n\n  return data;\n}\n\n\nfunction loadWidgets({name}) {\n  const widgets = document.querySelectorAll(`[data-toggle^=\"webex-${kebabCase(name)}\"]`);\n\n  for (const widget of widgets) {\n    // grab all data attributes that are not data-toggle\n    const props = getDataAttributes(widget);\n\n    // Use browser globals to init widget if available\n    if (window.webex.widget) {\n      const widgetObj = window.webex.widget(widget);\n      const widgetName = `${name}Widget`;\n\n      if (typeof widgetObj[widgetName] === 'function') {\n        widgetObj[widgetName](props);\n      }\n    }\n  }\n}\n\n\nexport default function withDataAPI({\n  name\n}) {\n  const onDOMReady = () => {\n    loadWidgets({name});\n    document.removeEventListener('DOMContentLoaded', onDOMReady);\n  };\n\n  return (BaseComponent) => {\n    // Only look for Widgets after the rest of the Widget constructor has initialized\n    document.addEventListener('DOMContentLoaded', onDOMReady, false);\n\n    return BaseComponent;\n  };\n}\n","import React from 'react';\nimport {IntlProvider, injectIntl} from 'react-intl';\nimport {shape, func} from 'prop-types';\n\nimport {setWrappedDisplayName} from '@webex/react-component-utils';\n\nexport default function withIntl({\n  messages,\n  locale\n}) {\n  // eslint-disable-reason Dynamically loading locale data to lower overhead\n  /* eslint-disable import/no-dynamic-require, global-require */\n  if (!Intl.PluralRules) {\n    require('@formatjs/intl-pluralrules/polyfill');\n    require(`@formatjs/intl-pluralrules/dist/locale-data/${locale}`);\n  }\n\n  if (!Intl.RelativeTimeFormat) {\n    require('@formatjs/intl-relativetimeformat/polyfill');\n    require(`@formatjs/intl-relativetimeformat/dist/locale-data/${locale}`);\n  }\n  /* eslint-enable import/no-dynamic-require, global-require */\n\n  return (BaseComponent) => {\n    const WrappedComponent = injectIntl(BaseComponent);\n\n    function WithIntl(props) {\n      return (\n        <IntlProvider locale={locale} messages={messages} >\n          <WrappedComponent {...props} />\n        </IntlProvider>\n      );\n    }\n\n    WrappedComponent.propTypes = {\n      // Grabbed from https://github.com/sharetribe/ftw-daily/blob/master/src/util/reactIntl.js#L10\n      intl: shape({\n        formatDate: func.isRequired,\n        formatHTMLMessage: func.isRequired,\n        formatMessage: func.isRequired,\n        formatNumber: func.isRequired,\n        formatPlural: func.isRequired,\n        formatRelativeTime: func.isRequired,\n        formatTime: func.isRequired\n      })\n    };\n\n    return setWrappedDisplayName('WithIntl')(WithIntl);\n  };\n}\n","import {\n  lifecycle,\n  compose\n} from 'recompose';\nimport {createSelector} from 'reselect';\nimport {bindActionCreators} from 'redux';\nimport {connect} from 'react-redux';\n\nimport {setWrappedDisplayName} from '@webex/react-component-utils';\nimport {fetchCurrentUser} from '@webex/redux-module-users';\n\nconst getUsers = (state) => state.users;\n\nconst getCurrentUser = createSelector(\n  [getUsers], (users) => {\n    const currentUserId = users.get('currentUserId');\n\n    return {\n      currentUser: users.getIn(['byId', currentUserId])\n    };\n  }\n);\n\nfunction fetchUser(props) {\n  const {spark, users} = props;\n\n  if (spark &&\n    spark.getIn(['status', 'registered']) &&\n    !users.get('currentUserId')\n  ) {\n    /* eslint-disable no-warning-comments */\n    // TODO rename sparkInstance to sdkInstance\n    /* eslint-enable no-warning-comments */\n    const sparkInstance = spark.get('spark');\n\n    props.fetchCurrentUser(sparkInstance);\n  }\n}\n\nexport default compose(\n  setWrappedDisplayName('WithCurrentUser'),\n  connect(\n    getCurrentUser,\n    (dispatch) => bindActionCreators({\n      fetchCurrentUser\n    }, dispatch)\n  ),\n  lifecycle({\n    componentDidMount() {\n      fetchUser(this.props);\n    },\n    componentWillReceiveProps(nextProps) {\n      fetchUser(nextProps);\n    }\n  })\n);\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import {\n  compose,\n  setDisplayName,\n  setStatic\n} from 'recompose';\n\nimport {withSpark} from '@webex/react-redux-spark';\nimport '@webex/react-component-spark-fonts';\n\nimport {\n  withInitialState,\n  withBrowserGlobals,\n  withIntl,\n  withDataAPI,\n  withRemoveWidget,\n  withCurrentUser\n} from './enhancers';\n\nimport './styles.css';\n\n/**\n * Creates an enhancer HOC that provides a store and connection to Spark\n * @param {Object} options\n * @param {Object} options.reducers Map of reducers that should be used to init a Store\n * @param {Object} options.enhancers Map of enhancers that should be used to init a Store\n * @returns {Object} React Component\n */\nexport function constructWebexEnhancer({\n  name,\n  reducers,\n  enhancers\n}) {\n  // Executes bottom to top. Bottom most HOC Will be the inner most Component\n  return compose(\n    // Instantiates Widgets into DOM with Data API (Must be at the top of compose)\n    withDataAPI({name}),\n    // Try to inject browser globals into global namespace\n    withBrowserGlobals({name}),\n    // Initialize state with react-redux Provider\n    withInitialState({reducers, enhancers}),\n    // Clears store on Remove\n    withRemoveWidget,\n    // Connects and Auths with Webex API\n    withSpark,\n    // Retrieves and stores current user\n    withCurrentUser,\n    // Set distinct display name\n    setDisplayName(`WebexWidgetBase(${name})`),\n    // Inject version number into component as static prop\n    setStatic('version', process.env.REACT_WEBEX_VERSION)\n  );\n}\n\n/**\n * Builds a Webex widget out of a React component\n * @param {String} name unique component name to inject into the global namespace\n * @param {Object} BaseComponent React Component\n * @returns {Object} React Component\n */\nexport default function WebexWidgetBase(name, BaseComponent) {\n  return constructWebexEnhancer(name)(BaseComponent);\n}\n\nexport {\n  withIntl,\n  withInitialState,\n  withBrowserGlobals\n};\n"],"names":["REMOVE_WIDGET","removeWidget","type","compose","setWrappedDisplayName","connect","state","dispatch","bindActionCreators","constructReducers","reducers","rootReducers","spark","sparkReducer","users","usersReducer","widgetReducer","combineReducers","action","undefined","withInitialState","devtools","window","__REDUX_DEVTOOLS_EXTENSION__","noop","middlewares","thunk","process","env","NODE_ENV","logger","createLogger","level","duration","collapsed","logErrors","push","BaseComponent","WithInitialState","Component","constructor","props","store","createStore","applyMiddleware","render","propTypes","PropTypes","object","defaultProps","formatEventDetails","name","data","resource","eventName","split","details","event","actorId","BrowserWidget","el","remove","callback","Promise","resolve","id","getAttribute","removed","ReactDOM","unmountComponentAtNode","Reflect","deleteProperty","webex","widgetStore","handleEvent","detail","CustomEvent","dispatchEvent","trigger","version","REACT_WEBEX_VERSION","widgetFn","Object","keys","forEach","fn","func","options","onEvent","call","bind","assign","getWidget","createNewWidget","widgetEl","prototype","Events","widgetObj","uuid","v4","setAttribute","selectWidget","nodeType","classList","add","console","warn","setupWidgetNamespace","widget","ciscospark","withBrowserGlobals","fnName","renderWidget","otherOptions","getDataAttributes","attribs","attributes","i","length","value","startsWith","camelCase","replace","loadWidgets","widgets","document","querySelectorAll","kebabCase","widgetName","withDataAPI","onDOMReady","removeEventListener","addEventListener","withIntl","messages","locale","Intl","PluralRules","require","RelativeTimeFormat","WrappedComponent","injectIntl","WithIntl","intl","shape","formatDate","isRequired","formatHTMLMessage","formatMessage","formatNumber","formatPlural","formatRelativeTime","formatTime","getUsers","getCurrentUser","createSelector","currentUserId","get","currentUser","getIn","fetchUser","sparkInstance","fetchCurrentUser","lifecycle","componentDidMount","componentWillReceiveProps","nextProps","styleInject","css","ref","insertAt","head","getElementsByTagName","style","createElement","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","constructWebexEnhancer","enhancers","withRemoveWidget","withSpark","withCurrentUser","setDisplayName","setStatic","WebexWidgetBase"],"mappings":"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"}