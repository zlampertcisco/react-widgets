{"version":3,"file":"index.js","sources":["../src/actions.js","../src/reducer.js","../src/enhancer.js"],"sourcesContent":["export const SET_CONNECTING = 'mercury/SET_CONNECTING';\nexport const SET_CONNECTED = 'mercury/SET_CONNECTED';\n\nfunction updateStatusConnecting(value) {\n  return {\n    type: SET_CONNECTING,\n    payload: value\n  };\n}\n\nfunction updateStatusConnected(value) {\n  return {\n    type: SET_CONNECTED,\n    payload: value\n  };\n}\n\n\nexport function connectToMercury(sparkInstance) {\n  return (dispatch) => {\n    if (sparkInstance) {\n      const {\n        canAuthorize,\n        internal\n      } = sparkInstance;\n      const {\n        device,\n        mercury\n      } = internal;\n\n      if (canAuthorize && device.registered\n        && !mercury.connected && !mercury.connecting) {\n        dispatch(updateStatusConnecting(true));\n\n        return mercury.connect().then(() =>\n          sparkInstance.listenToAndRun(mercury, 'change:connected', () =>\n            dispatch(updateStatusConnected(mercury.connected))));\n      }\n      // Handle if mercury is already connected from previous instance\n      if (mercury.connected) {\n        return dispatch(updateStatusConnected(mercury.connected));\n      }\n    }\n\n    return Promise.resolve();\n  };\n}\n\n","import {fromJS} from 'immutable';\n\nimport {\n  SET_CONNECTING,\n  SET_CONNECTED\n} from './actions';\n\nexport const initialState = fromJS({\n  status: {\n    connected: false,\n    connecting: false,\n    hasConnected: false\n  }\n});\n\nexport default function reducer(state = initialState, action) {\n  switch (action.type) {\n    case SET_CONNECTING: {\n      return state.setIn(['status', 'connecting'], action.payload);\n    }\n    case SET_CONNECTED: {\n      let hasConnected = state.getIn(['status', 'hasConnected']);\n\n      if (action.payload) {\n        hasConnected = true;\n      }\n\n      return state.setIn(['status', 'connected'], action.payload).setIn(['status', 'hasConnected'], hasConnected);\n    }\n    default: {\n      return state;\n    }\n  }\n}\n","import {connect} from 'react-redux';\nimport {bindActionCreators} from 'redux';\nimport {compose, lifecycle} from 'recompose';\n\nimport {setWrappedDisplayName} from '@webex/react-component-utils';\n\nimport {connectToMercury} from './actions';\n\nfunction setupMercury(props) {\n  const {\n    mercury,\n    sparkInstance,\n    sparkState\n  } = props;\n\n  if (sparkInstance\n    && sparkState.get('authenticated')\n    && sparkState.get('registered')\n    && !sparkState.get('hasError')\n    && !mercury.getIn(['status', 'hasConnected'])\n    && !mercury.getIn(['status', 'isConnecting'])\n    && !mercury.getIn(['status', 'isConnected'])\n    && sparkInstance.internal.device.registered\n  ) {\n    props.connectToMercury(sparkInstance);\n  }\n}\n\nexport default compose(\n  setWrappedDisplayName('WithMercury'),\n  connect(\n    (state) => state,\n    (dispatch) => bindActionCreators({\n      connectToMercury\n    }, dispatch)\n  ),\n  lifecycle({\n    componentWillReceiveProps(nextProps) {\n      setupMercury(nextProps);\n    }\n  })\n);\n"],"names":["SET_CONNECTING","SET_CONNECTED","updateStatusConnecting","value","type","payload","updateStatusConnected","connectToMercury","sparkInstance","dispatch","canAuthorize","internal","device","mercury","registered","connected","connecting","connect","then","listenToAndRun","Promise","resolve","initialState","fromJS","status","hasConnected","reducer","state","action","setIn","getIn","setupMercury","props","sparkState","get","compose","setWrappedDisplayName","bindActionCreators","lifecycle","componentWillReceiveProps","nextProps"],"mappings":"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"}