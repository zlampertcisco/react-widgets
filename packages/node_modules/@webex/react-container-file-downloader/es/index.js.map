{"version":3,"file":"index.js","sources":["../src/selectors.js","../src/index.js"],"sourcesContent":["import {createSelector} from 'reselect';\n\nconst getSpark = (state, ownProps) => ownProps.sparkInstance || state.spark.get('spark');\nconst getShare = (state) => state.share;\n\nconst getContainerProps = createSelector(\n  [getSpark, getShare],\n  (spark, share) => (\n    {\n      share,\n      spark\n    }\n  )\n);\n\nexport default getContainerProps;\n","import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {connect} from 'react-redux';\nimport {bindActionCreators} from 'redux';\nimport {saveAs} from 'file-saver';\nimport {autobind} from 'core-decorators';\nimport {bufferToBlob, getDisplayName} from '@webex/react-component-utils';\nimport {retrieveSharedFile} from '@webex/redux-module-share';\n\nimport getContainerProps from './selectors';\n\n// eslint-disable-next-line no-warning-comments\n// TODO: Rename this project to react-hoc-file-downloader\n\nfunction injectFileDownloader(WrappedComponent) {\n  const injectedPropTypes = {\n    share: PropTypes.object.isRequired,\n    spark: PropTypes.object.isRequired,\n    retrieveSharedFile: PropTypes.func.isRequired\n  };\n\n  const propTypes = {\n    files: PropTypes.array,\n    ...injectedPropTypes\n  };\n\n  const defaultProps = {\n    files: []\n  };\n\n  class FileDownloader extends Component {\n    componentDidMount() {\n      const {files} = this.props;\n\n      files.forEach((file) => {\n        this.getThumbnailImage(file);\n      });\n    }\n\n    @autobind\n    getSharedFileFromStore(fileUrl) {\n      const {props} = this;\n\n      return props.share.get(['files', fileUrl]);\n    }\n\n    getThumbnailImage(fileObject) {\n      const {image} = fileObject;\n\n      if (fileObject.mimeType === 'image/gif' && fileObject.url) {\n        this.retrieveFile(fileObject);\n      }\n      else if (image && (image.url && !this.getSharedFileFromStore(image.url) || image.scr)) {\n        this.retrieveFile(image);\n      }\n    }\n\n    @autobind\n    retrieveFile(file) {\n      const {props} = this;\n\n      props.retrieveSharedFile(file, props.spark);\n    }\n\n    @autobind\n    handleDownloadClick(fileObject) {\n      const {props} = this;\n      const cachedFile = this.getSharedFileFromStore(fileObject.url);\n\n      if (cachedFile && cachedFile.blob) {\n        saveAs(cachedFile.blob, fileObject.displayName);\n      }\n      else {\n        props.retrieveSharedFile(fileObject, props.spark)\n          .then((file) => {\n            const {blob} = bufferToBlob(file);\n\n            saveAs(blob, file.name);\n          });\n      }\n    }\n\n    render() {\n      return <WrappedComponent onDownloadClick={this.handleDownloadClick} {...this.props} />;\n    }\n  }\n\n\n  FileDownloader.propTypes = propTypes;\n  FileDownloader.defaultProps = defaultProps;\n\n  FileDownloader.displayName = `FileDownloader(${getDisplayName(WrappedComponent)})`;\n  FileDownloader.WrappedComponent = WrappedComponent;\n\n  return connect(\n    getContainerProps,\n    (dispatch) => bindActionCreators({\n      retrieveSharedFile\n    }, dispatch)\n  )(FileDownloader);\n}\n\nexport default injectFileDownloader;\n"],"names":["getSpark","state","ownProps","sparkInstance","spark","get","getShare","share","getContainerProps","createSelector","injectFileDownloader","WrappedComponent","injectedPropTypes","PropTypes","object","isRequired","retrieveSharedFile","func","propTypes","files","array","defaultProps","FileDownloader","Component","componentDidMount","props","forEach","file","getThumbnailImage","getSharedFileFromStore","fileUrl","fileObject","image","mimeType","url","retrieveFile","scr","handleDownloadClick","cachedFile","blob","saveAs","displayName","then","bufferToBlob","name","render","autobind","getDisplayName","connect","dispatch","bindActionCreators"],"mappings":"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"}