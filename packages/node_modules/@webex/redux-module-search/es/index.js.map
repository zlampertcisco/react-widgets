{"version":3,"file":"index.js","sources":["../src/helpers.js","../src/index.js"],"sourcesContent":["import {deconstructHydraId} from '@webex/react-component-utils';\n\nexport function normalizePersonResult(rawPerson) {\n  const person = {\n    ...rawPerson,\n    id: deconstructHydraId(rawPerson.id).id,\n    name: rawPerson.name ? rawPerson.name : rawPerson.displayName\n  };\n\n  return person;\n}\n\nexport default {};\n","import {fromJS} from 'immutable';\nimport isEmail from 'validator/lib/isEmail';\n\nimport {normalizePersonResult} from './helpers';\n\nexport const STORE_SEARCH_ERROR = 'search/STORE_SEARCH_ERROR';\nexport const STORE_SEARCH_RESULTS = 'search/STORE_SEARCH_RESULTS';\nexport const STORE_SEARCH_TERM = 'search/STORE_SEARCH_TERM';\n\nexport const initialState = fromJS({\n  error: null,\n  status: {\n    isError: false\n  },\n  searchResults: {}\n});\n\nexport default function reducer(state = initialState, action) {\n  switch (action.type) {\n    case STORE_SEARCH_TERM:\n      return state\n        .setIn(['status', 'isError'], false)\n        .setIn(['searchResults', action.payload.searchTerm, 'inProgress'], true);\n    case STORE_SEARCH_ERROR:\n      return state\n        .setIn(['status', 'isError'], true)\n        .set('error', action.payload.error);\n    case STORE_SEARCH_RESULTS:\n      return state\n        .mergeIn(['searchResults', action.payload.searchTerm], fromJS({\n          inProgress: false,\n          date: Date.now(),\n          results: action.payload.searchResults\n        }));\n    default:\n      return state;\n  }\n}\n\nfunction storeSearchTerm(searchTerm) {\n  return {\n    type: STORE_SEARCH_TERM,\n    payload: {\n      searchTerm\n    }\n  };\n}\n\nfunction storeSearchError(error) {\n  return {\n    type: STORE_SEARCH_ERROR,\n    payload: {\n      error\n    }\n  };\n}\n\nfunction storeSearchResults(searchTerm, searchResults) {\n  return {\n    type: STORE_SEARCH_RESULTS,\n    payload: {\n      searchTerm,\n      searchResults\n    }\n  };\n}\n\n/**\n * Searches the people endpoint for `searchTerm`\n *\n * @export\n * @param {string} searchTerm\n * @param {object} spark\n * @returns {function}\n */\nexport function searchForUser(searchTerm, spark) {\n  return (dispatch) => {\n    dispatch(storeSearchTerm(searchTerm));\n    if (isEmail(searchTerm)) {\n      return spark.people.list({email: searchTerm})\n        .then((response) => dispatch(storeSearchResults(searchTerm, response.items.map(normalizePersonResult))))\n        .catch((error) => dispatch(storeSearchError(error)));\n    }\n\n    return spark.internal.search.people({query: searchTerm})\n      .then((users) => {\n        dispatch(storeSearchResults(searchTerm, users));\n\n        return Promise.resolve(users);\n      })\n      .catch((error) => {\n        dispatch(storeSearchError(error));\n\n        return Promise.reject(error);\n      });\n  };\n}\n"],"names":["normalizePersonResult","rawPerson","person","id","deconstructHydraId","name","displayName","STORE_SEARCH_ERROR","STORE_SEARCH_RESULTS","STORE_SEARCH_TERM","initialState","fromJS","error","status","isError","searchResults","reducer","state","action","type","setIn","payload","searchTerm","set","mergeIn","inProgress","date","Date","now","results","storeSearchTerm","storeSearchError","storeSearchResults","searchForUser","spark","dispatch","isEmail","people","list","email","then","response","items","map","catch","internal","search","query","users","Promise","resolve","reject"],"mappings":";;;;AAEO,SAASA,qBAAT,CAA+BC,SAA/B,EAA0C;AAC/C,QAAMC,MAAM,GAAG,EACb,GAAGD,SADU;AAEbE,IAAAA,EAAE,EAAEC,kBAAkB,CAACH,SAAS,CAACE,EAAX,CAAlB,CAAiCA,EAFxB;AAGbE,IAAAA,IAAI,EAAEJ,SAAS,CAACI,IAAV,GAAiBJ,SAAS,CAACI,IAA3B,GAAkCJ,SAAS,CAACK;AAHrC,GAAf;AAMA,SAAOJ,MAAP;AACD;;MCLYK,kBAAkB,GAAG;MACrBC,oBAAoB,GAAG;MACvBC,iBAAiB,GAAG;MAEpBC,YAAY,GAAGC,MAAM,CAAC;AACjCC,EAAAA,KAAK,EAAE,IAD0B;AAEjCC,EAAAA,MAAM,EAAE;AACNC,IAAAA,OAAO,EAAE;AADH,GAFyB;AAKjCC,EAAAA,aAAa,EAAE;AALkB,CAAD;AAQnB,SAASC,OAAT,CAAiBC,KAAK,GAAGP,YAAzB,EAAuCQ,MAAvC,EAA+C;AAC5D,UAAQA,MAAM,CAACC,IAAf;AACE,SAAKV,iBAAL;AACE,aAAOQ,KAAK,CACTG,KADI,CACE,CAAC,QAAD,EAAW,SAAX,CADF,EACyB,KADzB,EAEJA,KAFI,CAEE,CAAC,eAAD,EAAkBF,MAAM,CAACG,OAAP,CAAeC,UAAjC,EAA6C,YAA7C,CAFF,EAE8D,IAF9D,CAAP;;AAGF,SAAKf,kBAAL;AACE,aAAOU,KAAK,CACTG,KADI,CACE,CAAC,QAAD,EAAW,SAAX,CADF,EACyB,IADzB,EAEJG,GAFI,CAEA,OAFA,EAESL,MAAM,CAACG,OAAP,CAAeT,KAFxB,CAAP;;AAGF,SAAKJ,oBAAL;AACE,aAAOS,KAAK,CACTO,OADI,CACI,CAAC,eAAD,EAAkBN,MAAM,CAACG,OAAP,CAAeC,UAAjC,CADJ,EACkDX,MAAM,CAAC;AAC5Dc,QAAAA,UAAU,EAAE,KADgD;AAE5DC,QAAAA,IAAI,EAAEC,IAAI,CAACC,GAAL,EAFsD;AAG5DC,QAAAA,OAAO,EAAEX,MAAM,CAACG,OAAP,CAAeN;AAHoC,OAAD,CADxD,CAAP;;AAMF;AACE,aAAOE,KAAP;AAjBJ;AAmBD;;AAED,SAASa,eAAT,CAAyBR,UAAzB,EAAqC;AACnC,SAAO;AACLH,IAAAA,IAAI,EAAEV,iBADD;AAELY,IAAAA,OAAO,EAAE;AACPC,MAAAA;AADO;AAFJ,GAAP;AAMD;;AAED,SAASS,gBAAT,CAA0BnB,KAA1B,EAAiC;AAC/B,SAAO;AACLO,IAAAA,IAAI,EAAEZ,kBADD;AAELc,IAAAA,OAAO,EAAE;AACPT,MAAAA;AADO;AAFJ,GAAP;AAMD;;AAED,SAASoB,kBAAT,CAA4BV,UAA5B,EAAwCP,aAAxC,EAAuD;AACrD,SAAO;AACLI,IAAAA,IAAI,EAAEX,oBADD;AAELa,IAAAA,OAAO,EAAE;AACPC,MAAAA,UADO;AAEPP,MAAAA;AAFO;AAFJ,GAAP;AAOD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASkB,aAAT,CAAuBX,UAAvB,EAAmCY,KAAnC,EAA0C;AAC/C,SAAQC,QAAD,IAAc;AACnBA,IAAAA,QAAQ,CAACL,eAAe,CAACR,UAAD,CAAhB,CAAR;;AACA,QAAIc,OAAO,CAACd,UAAD,CAAX,EAAyB;AACvB,aAAOY,KAAK,CAACG,MAAN,CAAaC,IAAb,CAAkB;AAACC,QAAAA,KAAK,EAAEjB;AAAR,OAAlB,EACJkB,IADI,CACEC,QAAD,IAAcN,QAAQ,CAACH,kBAAkB,CAACV,UAAD,EAAamB,QAAQ,CAACC,KAAT,CAAeC,GAAf,CAAmB3C,qBAAnB,CAAb,CAAnB,CADvB,EAEJ4C,KAFI,CAEGhC,KAAD,IAAWuB,QAAQ,CAACJ,gBAAgB,CAACnB,KAAD,CAAjB,CAFrB,CAAP;AAGD;;AAED,WAAOsB,KAAK,CAACW,QAAN,CAAeC,MAAf,CAAsBT,MAAtB,CAA6B;AAACU,MAAAA,KAAK,EAAEzB;AAAR,KAA7B,EACJkB,IADI,CACEQ,KAAD,IAAW;AACfb,MAAAA,QAAQ,CAACH,kBAAkB,CAACV,UAAD,EAAa0B,KAAb,CAAnB,CAAR;AAEA,aAAOC,OAAO,CAACC,OAAR,CAAgBF,KAAhB,CAAP;AACD,KALI,EAMJJ,KANI,CAMGhC,KAAD,IAAW;AAChBuB,MAAAA,QAAQ,CAACJ,gBAAgB,CAACnB,KAAD,CAAjB,CAAR;AAEA,aAAOqC,OAAO,CAACE,MAAR,CAAevC,KAAf,CAAP;AACD,KAVI,CAAP;AAWD,GAnBD;AAoBD;;;;;"}