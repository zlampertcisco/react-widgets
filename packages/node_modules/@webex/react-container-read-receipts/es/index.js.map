{"version":3,"file":"index.js","sources":["../src/selectors.js","../../../../../node_modules/style-inject/dist/style-inject.es.js","../src/index.js"],"sourcesContent":["import {createSelector} from 'reselect';\nimport {orderBy} from 'lodash';\nimport {getActivitiesFromThreadAndNonThreadCollections} from '@webex/redux-module-conversation';\n\nconst getConversationThreadActivities = (state) => state.conversation.get('threadActivities');\nconst getConversationNonThreadActivities = (state) => state.conversation.get('sortNonThreadActivities');\nconst getActivities = createSelector(\n  [\n    getConversationThreadActivities,\n    getConversationNonThreadActivities\n  ],\n  getActivitiesFromThreadAndNonThreadCollections\n);\nconst getParticipants = (state) => state.conversation.get('participants');\nconst getUsers = (state) => state.users;\nconst getTypingIndicators = (state) => state.indicators.get('typing');\nconst getSpark = (state, ownProps) => ownProps.sparkInstance || state.spark.get('spark');\n\nconst READ_RECEIPTS_SHOWN_LIMIT = 10;\n\nconst getCurrentUser = createSelector(\n  [getUsers], (users) => users.getIn(['byId', users.get('currentUserId')])\n);\n\nconst getReadReceipts = createSelector(\n  [getCurrentUser, getActivities, getParticipants, getTypingIndicators],\n  (currentUser, activities, participants, typing) => {\n    const activity = activities.last();\n    const readParticipants = participants\n      .filter((participant) =>\n        activity && currentUser && participant.get('id') !== currentUser.id &&\n        participant.getIn(['roomProperties', 'lastSeenActivityUUID']) === activity.id)\n      .toJS();\n\n    const mappedParticipants = readParticipants\n      .map((participant) => {\n        const participantId = participant.id;\n        // Typing events don't give us user IDs, only emails.\n        const isTyping = typing.has(participant.emailAddress);\n\n        return {\n          displayName: participant.displayName,\n          isTyping,\n          userId: participantId\n        };\n      });\n    const sortedParticipants = orderBy(mappedParticipants, 'isTyping', 'desc');\n    const visibleUsers = sortedParticipants.slice(0, READ_RECEIPTS_SHOWN_LIMIT);\n    const hiddenUsers = sortedParticipants.slice(READ_RECEIPTS_SHOWN_LIMIT);\n\n    return {\n      hiddenUsers,\n      visibleUsers\n    };\n  }\n);\n\nconst getReadReceiptsProps = createSelector(\n  [getReadReceipts, getSpark],\n  (readReceipts, sparkInstance) => ({\n    readReceipts,\n    sparkInstance\n  })\n);\n\nexport default getReadReceiptsProps;\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {connect} from 'react-redux';\nimport {bindActionCreators} from 'redux';\nimport classNames from 'classnames';\nimport {fetchAvatarsForUsers} from '@webex/redux-module-avatar';\nimport TypingAvatar from '@webex/react-component-typing-avatar';\nimport Badge from '@webex/react-component-badge';\n\nimport getReadReceiptsProps from './selectors';\nimport styles from './styles.css';\n\nconst injectedPropTypes = {\n  fetchAvatarsForUsers: PropTypes.func.isRequired,\n  readReceipts: PropTypes.shape({\n    hiddenUsers: PropTypes.array,\n    visibleUsers: PropTypes.array\n  }),\n  sparkInstance: PropTypes.object\n};\n\nconst propTypes = {\n  ...injectedPropTypes\n};\n\nexport class ReadReceipts extends Component {\n  componentWillReceiveProps(nextProps) {\n    const {visibleUsers} = this.props.readReceipts;\n    const nextUsers = nextProps.readReceipts.visibleUsers;\n\n    if (visibleUsers !== nextUsers) {\n      this.props.fetchAvatarsForUsers(nextUsers.map((user) => user.userId), this.props.sparkInstance);\n    }\n  }\n\n  shouldComponentUpdate(nextProps) {\n    const {props} = this;\n\n    return nextProps.readReceipts !== props.readReceipts;\n  }\n\n  render() {\n    const {hiddenUsers, visibleUsers} = this.props.readReceipts;\n    const readReceipts = visibleUsers.map((user) =>\n      (<TypingAvatar\n        avatarId={user.userId}\n        isTyping={user.isTyping}\n        key={user.userId}\n        name={user.displayName}\n      />));\n\n    if (hiddenUsers.length) {\n      const badgeTooltip = hiddenUsers\n        .slice(0, 10)\n        .map((u) => <p key={u.userId}>{u.displayName}</p>);\n\n      if (hiddenUsers.length > 10) {\n        const remainingHidden = `+${hiddenUsers.length - 10}`;\n\n        badgeTooltip.push(<p>{remainingHidden}</p>);\n      }\n      readReceipts.push(\n        <Badge\n          key={`${hiddenUsers.length}-remaining`}\n          tooltip={badgeTooltip}\n        >\n          {`+${hiddenUsers.length}`}\n        </Badge>\n      );\n    }\n\n    return (\n      <div className={classNames('webex-read-receipts', styles.readReceipts)}>\n        {readReceipts}\n      </div>\n    );\n  }\n}\n\n\nReadReceipts.propTypes = propTypes;\n\nexport default connect(\n  getReadReceiptsProps,\n  (dispatch) => bindActionCreators({\n    fetchAvatarsForUsers\n  }, dispatch)\n)(ReadReceipts);\n"],"names":["getConversationThreadActivities","state","conversation","get","getConversationNonThreadActivities","getActivities","createSelector","getActivitiesFromThreadAndNonThreadCollections","getParticipants","getUsers","users","getTypingIndicators","indicators","getSpark","ownProps","sparkInstance","spark","READ_RECEIPTS_SHOWN_LIMIT","getCurrentUser","getIn","getReadReceipts","currentUser","activities","participants","typing","activity","last","readParticipants","filter","participant","id","toJS","mappedParticipants","map","participantId","isTyping","has","emailAddress","displayName","userId","sortedParticipants","orderBy","visibleUsers","slice","hiddenUsers","getReadReceiptsProps","readReceipts","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","injectedPropTypes","fetchAvatarsForUsers","PropTypes","func","isRequired","shape","array","object","propTypes","ReadReceipts","Component","componentWillReceiveProps","nextProps","props","nextUsers","user","shouldComponentUpdate","render","length","badgeTooltip","u","remainingHidden","push","classNames","styles","connect","dispatch","bindActionCreators"],"mappings":"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"}