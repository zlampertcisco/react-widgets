{"version":3,"file":"index.js","sources":["../../../../../node_modules/style-inject/dist/style-inject.es.js","../src/components/ComposerButtons.js","../src/actions.js","../src/container.js","../src/reducer.js"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","/* eslint-disable jsx-a11y/label-has-for */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport uuid from 'uuid';\n\nimport {Icon} from '@momentum-ui/react';\n\nimport styles from './ComposerButtons.css';\n\nfunction ComposerButtons({onAttachFile, composerActions}) {\n  const inputId = `messageFileInput-${uuid.v4()}`;\n\n  return (\n    (\n      composerActions.attachFiles &&\n      <div className={classNames('webex-message-composer-buttons', styles.buttonsArea)}>\n        <input\n          className={classNames('webex-file-input', styles.fileInput)}\n          id={inputId}\n          multiple=\"multiple\"\n          onChange={onAttachFile}\n          type=\"file\"\n        />\n        <label htmlFor={inputId}>\n          <Icon\n            ariaLabel=\"Attach Files\"\n            name=\"attachment_16\"\n          />\n        </label>\n      </div>\n    ) || null\n  );\n}\n\nComposerButtons.propTypes = {\n  onAttachFile: PropTypes.func\n};\n\nComposerButtons.defaultProps = {\n  onAttachFile: () => {}\n};\n\nexport default ComposerButtons;\n","export const UPDATE_TEXTAREA_FOCUS = 'UPDATE_TEXTAREA_FOCUS';\n\nexport function blurTextArea() {\n  return {\n    type: UPDATE_TEXTAREA_FOCUS,\n    payload: {\n      hasTextAreaFocus: false\n    }\n  };\n}\n\nexport function focusTextArea() {\n  return {\n    type: UPDATE_TEXTAREA_FOCUS,\n    payload: {\n      hasTextAreaFocus: true\n    }\n  };\n}\n","import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {connect} from 'react-redux';\nimport {bindActionCreators} from 'redux';\nimport classNames from 'classnames';\nimport {debounce} from 'lodash';\nimport {autobind} from 'core-decorators';\nimport {\n  MentionsInput,\n  Mention\n} from 'react-mentions';\nimport {\n  addFiles,\n  removeFile,\n  setUserTyping,\n  submitActivity,\n  storeActivityText\n} from '@webex/redux-module-activity';\nimport {searchForUser} from '@webex/redux-module-search';\nimport PresenceAvatar from '@webex/react-container-presence-avatar';\nimport FileStagingArea from '@webex/react-component-file-staging-area';\nimport {constructFiles, checkMaxFileSize} from '@webex/react-component-utils';\nimport {addError, removeError} from '@webex/redux-module-errors';\n\nimport ComposerButtons from './components/ComposerButtons';\n\nimport {blurTextArea, focusTextArea} from './actions';\nimport styles from './styles.css';\nimport mentionStyles from './mentions.css';\n\nconst injectedPropTypes = {\n  activity: PropTypes.object.isRequired,\n  avatar: PropTypes.object.isRequired,\n  conversation: PropTypes.object.isRequired,\n  sparkInstance: PropTypes.object.isRequired,\n  users: PropTypes.object.isRequired,\n  currentUser: PropTypes.object.isRequired,\n  messageComposer: PropTypes.object.isRequired,\n  addFiles: PropTypes.func.isRequired,\n  blurTextArea: PropTypes.func.isRequired,\n  focusTextArea: PropTypes.func.isRequired,\n  removeFile: PropTypes.func.isRequired,\n  setUserTyping: PropTypes.func.isRequired,\n  submitActivity: PropTypes.func.isRequired,\n  searchForUser: PropTypes.func.isRequired,\n  storeActivityText: PropTypes.func.isRequired,\n  addError: PropTypes.func.isRequired,\n  removeError: PropTypes.func.isRequired\n};\n\nconst propTypes = {\n  composerActions: PropTypes.shape({\n    attachFiles: PropTypes.bool\n  }).isRequired,\n  onSubmit: PropTypes.func.isRequired,\n  placeholder: PropTypes.string,\n  showMentions: PropTypes.bool,\n  ...injectedPropTypes\n};\n\nconst defaultProps = {\n  placeholder: '',\n  showMentions: false\n};\n\n\nexport class MessageComposer extends Component {\n  constructor(props) {\n    super(props);\n    this.timerId = 0;\n    this.setUserStartTyping = debounce(this.setUserStartTyping, 500, {leading: true, trailing: false});\n  }\n\n  shouldComponentUpdate(nextProps) {\n    const {props} = this;\n\n    return props.activity !== nextProps.activity || props.placeholder !== nextProps.placeholder;\n  }\n\n  @autobind\n  setUserTyping(state) {\n    const {props} = this;\n    const {\n      conversation,\n      sparkInstance\n    } = props;\n\n    props.setUserTyping(state, conversation, sparkInstance);\n  }\n\n  @autobind\n  setUserStopTyping() {\n    this.setUserTyping(false);\n  }\n\n  setUserStartTyping() {\n    this.setUserTyping(true);\n  }\n\n  @autobind\n  handleTextChange(e, newValue, newValuePlainText) {\n    const {props} = this;\n    let {value} = e.target;\n\n    if (newValue && newValue.length) {\n      value = newValue;\n    }\n    props.storeActivityText(value, newValuePlainText);\n\n    clearTimeout(this.timerId);\n    if (value === '') {\n      this.setUserTyping(false);\n    }\n    else {\n      if (!props.activity.getIn(['status', 'isTyping'])) {\n        this.setUserStartTyping();\n      }\n      this.timerId = setTimeout(this.setUserStopTyping, 3000);\n    }\n  }\n\n  @autobind\n  handleKeyDown(e) {\n    if (e.keyCode === 13 && !e.shiftKey && !e.altKey && !e.ctrlKey && !e.metaKey) {\n      this.handleSubmit();\n      e.preventDefault();\n    }\n  }\n\n  @autobind\n  handleSubmit() {\n    const {props} = this;\n    const {\n      activity,\n      conversation,\n      sparkInstance,\n      currentUser,\n      onSubmit\n    } = props;\n\n    if (activity.get('text').length === 0 && activity.get('files').size === 0) {\n      return;\n    }\n    this.setUserTyping(false);\n    props.submitActivity(conversation, activity, currentUser, sparkInstance);\n\n    if (typeof onSubmit === 'function') {\n      onSubmit();\n    }\n  }\n\n  @autobind\n  handleTextAreaBlur() {\n    const {props} = this;\n    const {\n      conversation,\n      sparkInstance\n    } = props;\n\n    props.blurTextArea();\n    props.setUserTyping(false, conversation, sparkInstance);\n  }\n\n  @autobind\n  handleTextAreaFocus() {\n    this.props.focusTextArea();\n  }\n\n  @autobind\n  handleAddFile(e) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    if (e.target.files.length) {\n      const {props} = this;\n      const {\n        activity,\n        conversation,\n        sparkInstance\n      } = props;\n\n      const files = constructFiles(e.target.files);\n\n      if (checkMaxFileSize(files, props.addError, props.removeError)) {\n        props.addFiles(conversation, activity, files, sparkInstance);\n      }\n\n      // Clear the value of the input so the same file can be added again.\n      e.target.value = '';\n    }\n  }\n\n  @autobind\n  handleFileRemove(id) {\n    const {props} = this;\n\n    props.removeFile(id, props.activity);\n  }\n\n  @autobind\n  searchForMention(term) {\n    const {\n      avatar,\n      conversation,\n      currentUser\n    } = this.props;\n    const participants = [];\n\n    if (conversation.has('participants') && conversation.get('participants').count()) {\n      conversation.get('participants').toJS().forEach((p) => {\n        if (currentUser.id !== p.id) {\n          participants.push({\n            display: p.displayName,\n            id: p.id,\n            avatarUrl: avatar.getIn(['items', p.id])\n          });\n        }\n      });\n\n      if (term) {\n        return participants.filter((p) => p.display.toLowerCase().includes(term.toLowerCase()));\n      }\n    }\n\n    return participants;\n  }\n\n  static renderSuggestion(entry, search, highlightedDisplay) {\n    return (\n      <div className={mentionStyles.content}>\n        <div className={mentionStyles.avatar}>\n          <PresenceAvatar avatarId={entry.id} name={entry.display} size={24} />\n        </div>\n        <div className={mentionStyles.highlightedDisplay}>\n          {highlightedDisplay}\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    let text;\n    const {props} = this;\n    const {\n      activity,\n      composerActions,\n      messageComposer,\n      placeholder,\n      conversation\n    } = this.props;\n\n    const files = activity.get('files');\n\n    if (activity && activity.has('text')) {\n      text = activity.get('text');\n    }\n\n    const textAreaFocusStyle = messageComposer.getIn(['status', 'hasTextAreaFocus']) ? styles.hasFocus : '';\n    const mentionMarkup = '@{__display__}|__id__|';\n\n    // Only show mentions if this is not a one on one convo\n    const showMentions = props.showMentions && !conversation.getIn(['status', 'isOneOnOne']);\n    const getData = showMentions ? this.searchForMention : () => {};\n\n    return (\n      <div className={classNames('webex-message-composer', styles.messageComposer, textAreaFocusStyle)}>\n        <ComposerButtons\n          composerActions={composerActions}\n          onAttachFile={this.handleAddFile}\n        />\n        {files && files.count() > 0 &&\n          <FileStagingArea\n            files={files}\n            onFileRemove={this.handleFileRemove}\n          />\n        }\n        <div className={classNames('webex-textarea-container', styles.textAreaContainer)}>\n          <MentionsInput\n            classNames={mentionStyles}\n            markup={mentionMarkup}\n            onBlur={this.handleTextAreaBlur}\n            onChange={this.handleTextChange}\n            onFocus={this.handleTextAreaFocus}\n            onKeyDown={this.handleKeyDown}\n            onSubmit={this.handleSubmit}\n            placeholder={placeholder}\n            rows={1}\n            value={text}\n          >\n            <Mention\n              className={mentionStyles.mentions__mention}\n              data={getData}\n              renderSuggestion={MessageComposer.renderSuggestion}\n              trigger=\"@\"\n            />\n          </MentionsInput>\n        </div>\n      </div>\n    );\n  }\n}\n\n\nMessageComposer.propTypes = propTypes;\nMessageComposer.defaultProps = defaultProps;\n\nfunction mapStateToProps(state, ownProps) {\n  return {\n    activity: state.activity,\n    avatar: state.avatar,\n    conversation: state.conversation,\n    sparkInstance: ownProps.sparkInstance || state.spark.get('spark'),\n    users: state.users,\n    messageComposer: state.messageComposer,\n    currentUser: state.users.getIn(['byId', state.users.get('currentUserId')])\n  };\n}\n\nexport default connect(\n  mapStateToProps,\n  (dispatch) => bindActionCreators({\n    addFiles,\n    blurTextArea,\n    focusTextArea,\n    removeFile,\n    setUserTyping,\n    submitActivity,\n    searchForUser,\n    storeActivityText,\n    addError,\n    removeError\n  }, dispatch)\n)(MessageComposer);\n","import {fromJS} from 'immutable';\n\nimport {UPDATE_TEXTAREA_FOCUS} from './actions';\n\nexport const initialState = fromJS({\n  status: {\n    hasTextAreaFocus: false\n  }\n});\n\nexport default function reducer(state = initialState, action) {\n  switch (action.type) {\n    case UPDATE_TEXTAREA_FOCUS:\n      return state.setIn(['status', 'hasTextAreaFocus'], action.payload.state);\n    default:\n      return state;\n  }\n}\n"],"names":["styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","ComposerButtons","onAttachFile","composerActions","inputId","uuid","v4","attachFiles","classNames","styles","buttonsArea","fileInput","propTypes","PropTypes","func","defaultProps","UPDATE_TEXTAREA_FOCUS","blurTextArea","payload","hasTextAreaFocus","focusTextArea","injectedPropTypes","activity","object","isRequired","avatar","conversation","sparkInstance","users","currentUser","messageComposer","addFiles","removeFile","setUserTyping","submitActivity","searchForUser","storeActivityText","addError","removeError","shape","bool","onSubmit","placeholder","string","showMentions","MessageComposer","Component","constructor","props","timerId","setUserStartTyping","debounce","leading","trailing","shouldComponentUpdate","nextProps","state","setUserStopTyping","handleTextChange","e","newValue","newValuePlainText","value","target","length","clearTimeout","getIn","setTimeout","handleKeyDown","keyCode","shiftKey","altKey","ctrlKey","metaKey","handleSubmit","preventDefault","get","size","handleTextAreaBlur","handleTextAreaFocus","handleAddFile","stopPropagation","files","constructFiles","checkMaxFileSize","handleFileRemove","id","searchForMention","term","participants","has","count","toJS","forEach","p","push","display","displayName","avatarUrl","filter","toLowerCase","includes","renderSuggestion","entry","search","highlightedDisplay","mentionStyles","content","render","text","textAreaFocusStyle","hasFocus","mentionMarkup","getData","textAreaContainer","mentions__mention","autobind","mapStateToProps","ownProps","spark","connect","dispatch","bindActionCreators","initialState","fromJS","status","reducer","action","setIn"],"mappings":"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"}