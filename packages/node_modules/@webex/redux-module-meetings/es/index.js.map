{"version":3,"file":"index.js","sources":["../src/reducer.js","../src/actions.js"],"sourcesContent":["import {\n  Record,\n  Map\n} from 'immutable';\n\nimport {\n  JOIN_MEETING,\n  LEAVE_MEETING,\n  STORE_MEETING,\n  UPDATE_MEETING_STATE\n} from './actions';\n\nconst MeetingState = Record({\n  joined: false,\n  hasLocalMedia: false,\n  hasRemoteVideo: false,\n  hasRemoteAudio: false\n});\n\nconst InitialState = Record({\n  byDestination: Map(),\n  byLocusUrl: Map(),\n  byId: Map()\n});\n\nexport const initialState = new InitialState();\n\nexport function buildDestinationLookup({destinationId, destinationType}) {\n  if (!destinationId || !destinationType) {\n    throw new Error('#buildDestinationLookup - requires destinationID and destinationType');\n  }\n\n  return `${destinationType}-${destinationId}`;\n}\n\nexport default function reducer(state = initialState, action) {\n  switch (action.type) {\n    // The source of truth for the meetings objects is the meetings collection\n    // within the SDK. Instead of storing the meeting object in the redux store,\n    // we will just be storing IDs and meeting state in order to do the collection lookup.\n    case STORE_MEETING: {\n      const {\n        meeting,\n        destinationId,\n        destinationType\n      } = action.payload;\n\n      const {locusUrl, id} = meeting;\n      const destination = buildDestinationLookup({destinationId, destinationType});\n\n      let updatedState = state.setIn(['byId', id], new MeetingState());\n\n      // Store a link to the meeting's ID by destination\n      updatedState = updatedState.setIn(['byDestination', destination], id);\n\n      // Store a link to the meeting's ID by locus\n      if (locusUrl) {\n        updatedState = updatedState.setIn(['byLocusUrl', locusUrl], id);\n      }\n\n      return updatedState;\n    }\n\n    // Update the meeting state to show it has been joined\n    case JOIN_MEETING: {\n      const {meeting} = action.payload;\n\n      return state.setIn(['byId', meeting.id, 'joined'], true);\n    }\n\n    // Update the meeting state to show it was left and not joined\n    case LEAVE_MEETING: {\n      const {meeting} = action.payload;\n\n      return state.setIn(['byId', meeting.id, 'joined'], false);\n    }\n\n    // Update the meeting state\n    case UPDATE_MEETING_STATE: {\n      const {meeting, meetingState} = action.payload;\n\n      return state.mergeIn(['byId', meeting.id], meetingState);\n    }\n\n    default:\n      return state;\n  }\n}\n","import {buildDestinationLookup} from './reducer';\n\nexport const JOIN_MEETING = 'meetings/JOIN_MEETING';\nexport const LEAVE_MEETING = 'meetings/LEAVE_MEETING';\nexport const STORE_MEETING = 'meetings/STORE_MEETING';\nexport const UPDATE_MEETING_STATE = 'meetings/UPDATE_MEETING_STATE';\n\n// Redux Actions\n\nfunction joinMeeting(meeting) {\n  return {\n    type: JOIN_MEETING,\n    payload: {\n      meeting\n    }\n  };\n}\n\nfunction leaveMeetingAction(meeting) {\n  return {\n    type: LEAVE_MEETING,\n    payload: {\n      meeting\n    }\n  };\n}\n\nfunction storeMeeting({destinationType, destinationId, meeting}) {\n  return {\n    type: STORE_MEETING,\n    payload: {\n      destinationType,\n      destinationId,\n      meeting\n    }\n  };\n}\n\nfunction updateMeetingState(meeting, meetingState) {\n  return {\n    type: UPDATE_MEETING_STATE,\n    payload: {\n      meeting,\n      meetingState\n    }\n  };\n}\n\n// Helper Methods\n\nfunction bindMeetingEvents(meeting, dispatch) {\n  // Handle media streams changes to ready state\n  meeting.on('media:ready', (media) => {\n    if (!media) {\n      return;\n    }\n    if (media.type === 'local') {\n      dispatch(updateMeetingState(meeting, {hasLocalMedia: true}));\n    }\n    if (media.type === 'remoteVideo') {\n      dispatch(updateMeetingState(meeting, {hasRemoteVideo: true}));\n    }\n    if (media.type === 'remoteAudio') {\n      dispatch(updateMeetingState(meeting, {hasRemoteAudio: true}));\n    }\n  });\n\n  /* eslint-disable no-warning-comments */\n  // TODO: Add media:stopped handlers\n\n  // TODO: Add meeting stopped & destroyed handlers\n  /* eslint-enable no-warning-comments */\n}\n\n/**\n * Gets the meeting instance from the SDK plugin\n *\n * @param {Object} config\n * @param {String} config.destinationId\n * @param {String} config.destinationType\n * @param {String} config.meetingId\n * @param {Object} config.meetings Redux state object from the store\n * @param {Object} sdkInstance\n * @returns {Object} meeting instance\n */\nfunction getMeetingFromSDK({\n  destinationId,\n  destinationType,\n  meetingId,\n  meetings\n}, sdkInstance) {\n  let calculatedMeetingId = meetingId;\n\n  if (!meetingId) {\n    if (!destinationId || !destinationType || !meetings) {\n      throw new Error('#getMeetingFromSDK - unable to lookup meeting');\n    }\n\n    const destination = buildDestinationLookup({destinationId, destinationType});\n\n    calculatedMeetingId = meetings.getIn(['byDestination', destination]);\n  }\n\n  const meeting = sdkInstance.meetings.meetingCollection.meetings[calculatedMeetingId];\n\n  if (!meeting) {\n    throw new Error('#getMeetingFromSDK - unable to locate meeting with id: ', calculatedMeetingId);\n  }\n\n  return meeting;\n}\n\n// Exported Action Creators (Should return thunks)\n\n/**\n * Creates a meeting and joins it via the SDK\n *\n * @param {Object} config\n * @param {String} config.destinationId\n * @param {String} config.destinationType\n * @param {Object} sdkInstance\n * @returns {Thunk}\n */\nexport function createAndJoinMeeting({destinationType, destinationId}, sdkInstance) {\n  return (dispatch) => sdkInstance.meetings.create(destinationId)\n    .then((meeting) => {\n      dispatch(storeMeeting({destinationId, destinationType, meeting}));\n\n      bindMeetingEvents(meeting, dispatch);\n\n      return meeting.join().then(() => {\n        dispatch(joinMeeting(meeting));\n\n        return meeting;\n      });\n    });\n}\n\n/**\n * Gets local media and adds it to the meeting\n *\n * @param {Object} config\n * @param {String} config.meetingId\n * @param {boolean} config.receiveVideo\n * @param {boolean} config.receiveAudio\n * @param {boolean} config.receiveShare\n * @param {boolean} config.sendAudio\n * @param {boolean} config.sendVideo\n * @param {boolean} config.sendShare\n * @param {Object} sdkInstance\n * @returns {Thunk}\n */\nexport function addMediaToMeeting({\n  meetingId,\n  receiveVideo,\n  receiveAudio,\n  receiveShare,\n  sendVideo,\n  sendAudio,\n  sendShare\n}, sdkInstance) {\n  return () => {\n    // Get meeting instance from the SDK\n    const meeting = getMeetingFromSDK({meetingId}, sdkInstance);\n\n    const mediaSettings = {\n      receiveVideo,\n      receiveAudio,\n      receiveShare,\n      sendVideo,\n      sendAudio,\n      sendShare\n    };\n\n    // Get our local media stream and add it to the meeting\n    return meeting.getMediaStreams(mediaSettings).then((mediaStreams) => {\n      const [localStream, localShare] = mediaStreams;\n\n      meeting.addMedia({\n        localShare,\n        localStream,\n        mediaSettings\n      });\n    });\n  };\n}\n\n/**\n * Leaves a meeting via the SDK\n *\n * @param {Object} config\n * @param {String} config.destinationId\n * @param {String} config.destinationType\n * @param {Object} sdkInstance\n * @returns {Thunk}\n  */\nexport function leaveMeeting({destinationType, destinationId}, sdkInstance) {\n  return (dispatch, getState) => {\n    const {meetings} = getState();\n\n    // Get meeting instance from the SDK\n    const meeting = getMeetingFromSDK({destinationId, destinationType, meetings}, sdkInstance);\n\n    return meeting.leave().then(() => {\n      dispatch(leaveMeetingAction(meeting));\n\n      return meeting;\n    });\n  };\n}\n"],"names":["MeetingState","Record","joined","hasLocalMedia","hasRemoteVideo","hasRemoteAudio","InitialState","byDestination","Map","byLocusUrl","byId","initialState","buildDestinationLookup","destinationId","destinationType","Error","reducer","state","action","type","STORE_MEETING","meeting","payload","locusUrl","id","destination","updatedState","setIn","JOIN_MEETING","LEAVE_MEETING","UPDATE_MEETING_STATE","meetingState","mergeIn","joinMeeting","leaveMeetingAction","storeMeeting","updateMeetingState","bindMeetingEvents","dispatch","on","media","getMeetingFromSDK","meetingId","meetings","sdkInstance","calculatedMeetingId","getIn","meetingCollection","createAndJoinMeeting","create","then","join","addMediaToMeeting","receiveVideo","receiveAudio","receiveShare","sendVideo","sendAudio","sendShare","mediaSettings","getMediaStreams","mediaStreams","localStream","localShare","addMedia","leaveMeeting","getState","leave"],"mappings":"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"}