{"version":3,"file":"index.js","sources":["../src/actions.js","../src/reducer.js"],"sourcesContent":["export const ADD_FLAG = 'flags/ADD_FLAG';\nexport const STORE_FLAGS = 'flags/STORE_FLAGS';\nexport const REMOVE_FLAG = 'flags/REMOVE_FLAG';\nexport const UPDATE_FLAG_STATUS = 'flags/UPDATE_FLAG_STATUS';\n\nfunction updateFlagStatus(status) {\n  return {\n    type: UPDATE_FLAG_STATUS,\n    payload: {\n      status\n    }\n  };\n}\n\n\nfunction addFlag(flag, error) {\n  return {\n    type: ADD_FLAG,\n    payload: {\n      flag,\n      error\n    }\n  };\n}\n\n\nfunction storeFlags(flags, error) {\n  return {\n    type: STORE_FLAGS,\n    payload: {\n      flags,\n      error\n    }\n  };\n}\n\n\nfunction removeFlag(flag, error) {\n  return {\n    type: REMOVE_FLAG,\n    payload: {\n      error,\n      flag\n    }\n  };\n}\n\n\nfunction constructFlag(flag) {\n  return {\n    id: flag.id,\n    url: flag.url,\n    activityUrl: flag['flag-item'],\n    isInFlight: false\n  };\n}\n\n\n/**\n * Fetches all of the current user's flags\n *\n * @param {any} sparkInstance\n * @returns {function}\n */\nexport function fetchFlags(sparkInstance) {\n  return (dispatch) => {\n    dispatch(updateFlagStatus({isFetching: true}));\n\n    return sparkInstance.internal?.flag?.list()\n      .then((flags) => {\n        let flagsMap = flags.map(constructFlag);\n\n        flagsMap = flagsMap.reduce((acc, val) => {\n          acc[val.activityUrl] = val;\n\n          return acc;\n        }, {});\n\n        return dispatch(storeFlags(flagsMap));\n      })\n      .catch((error) => sparkInstance.logger.warn(error));\n  };\n}\n\n/**\n * Flags a given activity. Updates state immediately then\n * adds flag details given from api\n *\n * @param {any} activity\n * @param {any} spark\n * @returns {function}\n */\nexport function flagActivity(activity, spark) {\n  return (dispatch) => {\n    const flagObject = {\n      activityUrl: activity.url,\n      isInFlight: true\n    };\n\n    dispatch(addFlag(flagObject));\n\n    return spark.internal.flag.create(activity)\n      .then((flag) =>\n        dispatch(addFlag(constructFlag(flag))))\n      .catch((error) => spark.logger.warn(error));\n  };\n}\n\n/**\n * Removes a flag from the server. Updates the state immediately\n * but re-adds it if the delete fails\n *\n * @param {any} flag\n * @param {any} spark\n * @returns {function}\n */\nexport function removeFlagFromServer(flag, spark) {\n  return (dispatch) => {\n    dispatch(removeFlag(flag));\n\n    return spark.internal.flag.delete(flag.toJS())\n      .catch((error) => {\n        spark.logger.warn(error);\n      });\n  };\n}\n","import {fromJS} from 'immutable';\n\nimport {\n  ADD_FLAG,\n  STORE_FLAGS,\n  REMOVE_FLAG,\n  UPDATE_FLAG_STATUS\n} from './actions';\n\n\nexport const initialState = fromJS({\n  flags: {},\n  error: null,\n  status: {\n    hasFetched: false,\n    isFetching: false\n  }\n});\n\nexport default function reducer(state = initialState, action) {\n  switch (action.type) {\n    case ADD_FLAG: {\n      const {flag, error} = action.payload;\n\n      if (error) {\n        return state.setIn(['flags', flag.activityUrl], {error});\n      }\n\n      return state.setIn(['flags', flag.activityUrl], fromJS(flag));\n    }\n\n    case STORE_FLAGS: {\n      const {flags, error} = action.payload;\n\n      if (error) {\n        return state.setIn(['status', 'hasFetched'], true)\n          .setIn(['status', 'isFetching'], false)\n          .set('error', error);\n      }\n\n      return state.setIn(['status', 'hasFetched'], true)\n        .setIn(['status', 'isFetching'], false)\n        .mergeDeepIn(['flags'], flags);\n    }\n\n    case REMOVE_FLAG: {\n      const {flag} = action.payload;\n\n      if (action.error) {\n      // Unable to delete flag, add it back in\n        return state.setIn(['flags', flag.activityUrl], fromJS(flag));\n      }\n\n      return state.deleteIn(['flags', flag.get('activityUrl')]);\n    }\n\n    case UPDATE_FLAG_STATUS: {\n      return state.mergeDeepIn(['status'], action.payload.status);\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n"],"names":["ADD_FLAG","STORE_FLAGS","REMOVE_FLAG","UPDATE_FLAG_STATUS","updateFlagStatus","status","type","payload","addFlag","flag","error","storeFlags","flags","removeFlag","constructFlag","id","url","activityUrl","isInFlight","fetchFlags","sparkInstance","dispatch","isFetching","internal","list","then","flagsMap","map","reduce","acc","val","catch","logger","warn","flagActivity","activity","spark","flagObject","create","removeFlagFromServer","delete","toJS","initialState","fromJS","hasFetched","reducer","state","action","setIn","set","mergeDeepIn","deleteIn","get"],"mappings":"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"}