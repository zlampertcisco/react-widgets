{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import {Map, OrderedMap} from 'immutable';\nimport {bufferToBlob} from '@webex/react-component-utils';\n\nexport const FETCH_SHARE = 'share/FETCH_SHARE';\nexport const RECEIVE_SHARE = 'share/RECEIVE_SHARE';\n\nexport const initialState = new Map({\n  files: new OrderedMap({})\n});\n\nexport default function reducer(state = initialState, action) {\n  switch (action.type) {\n    case RECEIVE_SHARE: {\n      const {\n        file,\n        fileObject\n      } = action.payload;\n      const {blob, objectUrl} = bufferToBlob(file);\n      const key = fileObject.url;\n\n      return state.setIn(['files', key], new Map({\n        name: fileObject.displayName,\n        mimeType: fileObject.mimeType,\n        fileSize: fileObject.fileSize,\n        isFetching: false,\n        blob,\n        objectUrl\n      }));\n    }\n\n    case FETCH_SHARE: {\n      const key = action.payload.fileObject.url;\n\n      return state.setIn(['files', key, 'isFetching'], true);\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n\nfunction fetchShare(fileObject) {\n  return {\n    type: FETCH_SHARE,\n    payload: {\n      fileObject\n    }\n  };\n}\n\nfunction receiveShare(payload) {\n  return {\n    type: RECEIVE_SHARE,\n    payload\n  };\n}\n\nexport function retrieveSharedFile(fileObject, spark) {\n  return (dispatch) => {\n    dispatch(fetchShare(fileObject));\n\n    return spark.internal.conversation.download(fileObject)\n      .then((file) => {\n        dispatch(receiveShare({file, fileObject}, false));\n\n        return file;\n      });\n  };\n}\n"],"names":["FETCH_SHARE","RECEIVE_SHARE","initialState","Map","files","OrderedMap","reducer","state","action","type","file","fileObject","payload","blob","objectUrl","bufferToBlob","key","url","setIn","name","displayName","mimeType","fileSize","isFetching","fetchShare","receiveShare","retrieveSharedFile","spark","dispatch","internal","conversation","download","then"],"mappings":";;;MAGaA,WAAW,GAAG;MACdC,aAAa,GAAG;MAEhBC,YAAY,GAAG,IAAIC,GAAJ,CAAQ;AAClCC,EAAAA,KAAK,EAAE,IAAIC,UAAJ,CAAe,EAAf;AAD2B,CAAR;AAIb,SAASC,OAAT,CAAiBC,KAAK,GAAGL,YAAzB,EAAuCM,MAAvC,EAA+C;AAC5D,UAAQA,MAAM,CAACC,IAAf;AACE,SAAKR,aAAL;AAAoB;AAClB,cAAM;AACJS,UAAAA,IADI;AAEJC,UAAAA;AAFI,YAGFH,MAAM,CAACI,OAHX;AAIA,cAAM;AAACC,UAAAA,IAAD;AAAOC,UAAAA;AAAP,YAAoBC,YAAY,CAACL,IAAD,CAAtC;AACA,cAAMM,GAAG,GAAGL,UAAU,CAACM,GAAvB;AAEA,eAAOV,KAAK,CAACW,KAAN,CAAY,CAAC,OAAD,EAAUF,GAAV,CAAZ,EAA4B,IAAIb,GAAJ,CAAQ;AACzCgB,UAAAA,IAAI,EAAER,UAAU,CAACS,WADwB;AAEzCC,UAAAA,QAAQ,EAAEV,UAAU,CAACU,QAFoB;AAGzCC,UAAAA,QAAQ,EAAEX,UAAU,CAACW,QAHoB;AAIzCC,UAAAA,UAAU,EAAE,KAJ6B;AAKzCV,UAAAA,IALyC;AAMzCC,UAAAA;AANyC,SAAR,CAA5B,CAAP;AAQD;;AAED,SAAKd,WAAL;AAAkB;AAChB,cAAMgB,GAAG,GAAGR,MAAM,CAACI,OAAP,CAAeD,UAAf,CAA0BM,GAAtC;AAEA,eAAOV,KAAK,CAACW,KAAN,CAAY,CAAC,OAAD,EAAUF,GAAV,EAAe,YAAf,CAAZ,EAA0C,IAA1C,CAAP;AACD;;AAED;AAAS;AACP,eAAOT,KAAP;AACD;AA3BH;AA6BD;;AAED,SAASiB,UAAT,CAAoBb,UAApB,EAAgC;AAC9B,SAAO;AACLF,IAAAA,IAAI,EAAET,WADD;AAELY,IAAAA,OAAO,EAAE;AACPD,MAAAA;AADO;AAFJ,GAAP;AAMD;;AAED,SAASc,YAAT,CAAsBb,OAAtB,EAA+B;AAC7B,SAAO;AACLH,IAAAA,IAAI,EAAER,aADD;AAELW,IAAAA;AAFK,GAAP;AAID;;AAEM,SAASc,kBAAT,CAA4Bf,UAA5B,EAAwCgB,KAAxC,EAA+C;AACpD,SAAQC,QAAD,IAAc;AACnBA,IAAAA,QAAQ,CAACJ,UAAU,CAACb,UAAD,CAAX,CAAR;AAEA,WAAOgB,KAAK,CAACE,QAAN,CAAeC,YAAf,CAA4BC,QAA5B,CAAqCpB,UAArC,EACJqB,IADI,CACEtB,IAAD,IAAU;AACdkB,MAAAA,QAAQ,CAACH,YAAY,CAAC;AAACf,QAAAA,IAAD;AAAOC,QAAAA;AAAP,OAAD,CAAb,CAAR;AAEA,aAAOD,IAAP;AACD,KALI,CAAP;AAMD,GATD;AAUD;;;;;"}