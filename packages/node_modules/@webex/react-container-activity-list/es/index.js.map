{"version":3,"file":"index.js","sources":["../src/formatters/linkify.js","../../../../../node_modules/style-inject/dist/style-inject.es.js","../src/formatters/at-mention.js","../src/formatters/index.js","../src/helpers.js","../src/selectors.js","../src/index.js"],"sourcesContent":["import linkifyHtml from 'linkifyjs/html';\nimport linkifyStr from 'linkifyjs/string';\n\nexport default (activity) => {\n  const linkifyOptions = {\n    ignoreTags: ['code', 'pre'],\n    className: 'webex-activity-link'\n  };\n\n  if (activity.content) {\n    return Object.assign({}, activity, {content: linkifyHtml(activity.content, linkifyOptions)});\n  }\n\n  return Object.assign({}, activity, {content: linkifyStr(activity.displayName, linkifyOptions)});\n};\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport {constructHydraId} from '@webex/react-component-utils';\n\nimport styles from './at-mention.css';\n\nconst EVENT_NAME_MENTION_CLICKED = 'mention:clicked';\n\nconst propTypes = {\n  content: PropTypes.string,\n  onEvent: PropTypes.func\n};\n\nconst defaultProps = {\n  content: '',\n  onEvent: () => {}\n};\n\nfunction AtMentionComponent({\n  content,\n  onEvent\n}) {\n  function isMention(target) {\n    return target.tagName === 'SPARK-MENTION' && target.dataset;\n  }\n\n  function triggerEvent(e) {\n    const {target} = e;\n\n    if (isMention(target)) {\n      onEvent(EVENT_NAME_MENTION_CLICKED, {\n        type: target.dataset.objectType,\n        id: constructHydraId(target.dataset.objectType, target.dataset.objectId)\n      });\n    }\n  }\n\n  function handleClick(e) {\n    triggerEvent(e);\n  }\n\n  function handleKeyUp(e) {\n    if (e.keyCode && e.keyCode === 13) {\n      return triggerEvent(e);\n    }\n\n    return false;\n  }\n\n  return (\n    <div\n      className={classNames(styles.atMention)}\n      // eslint-disable-reason content is generated from elsewhere in the app\n      // eslint-disable-next-line react/no-danger\n      dangerouslySetInnerHTML={{__html: content}}\n      onClick={handleClick}\n      onKeyUp={handleKeyUp}\n      role=\"presentation\"\n    />\n  );\n}\n\nAtMentionComponent.propTypes = propTypes;\nAtMentionComponent.defaultProps = defaultProps;\n\n\nexport default (activity, onEvent) => {\n  if (activity.mentions) {\n    const component = (\n      <AtMentionComponent\n        content={activity.content}\n        mentions={activity.mentions.items}\n        onEvent={onEvent}\n      />\n    );\n\n    return Object.assign({}, activity, {component});\n  }\n\n  return activity;\n};\n","import linkify from './linkify';\nimport atMention from './at-mention';\n\nexport default (activity, onEvent) => {\n  const formatters = [linkify, atMention];\n  let result = activity;\n\n  formatters.forEach((formatter) => {\n    result = formatter(result, onEvent);\n  });\n\n  return result;\n};\n","const REPLY_TYPE = 'reply';\n\nexport const isReplyActivity = (activity) => activity.parent?.type === REPLY_TYPE;\n\nexport const VISIBLE_ACTIVITY_VERBS = {\n  tombstone: {},\n  share: {\n    objectTypes: ['content']\n  },\n  post: {\n    objectTypes: ['comment']\n  },\n  create: {\n    objectTypes: ['conversation']\n  },\n  update: {\n    objectTypes: ['locusSessionSummaryParticipant', 'locusSessionSummary']\n  },\n  add: {\n    objectTypes: ['person']\n  },\n  leave: {\n    objectTypes: ['person']\n  }\n};\n\nexport const LYRA_SPACE_TYPE = 'LYRA_SPACE';\n\n/**\n * Determines if an activity object is a visible activity\n * @param {object} activity\n * @returns {bool}\n */\nexport function isActivityVisible(activity) {\n  if (activity.object) {\n    const {\n      type\n    } = activity.object;\n\n    // Do not show activity if its object type is 'LYRA_SPACE'\n    if (type === LYRA_SPACE_TYPE) {\n      return false;\n    }\n  }\n  if (!Object.prototype.hasOwnProperty.call(VISIBLE_ACTIVITY_VERBS, activity.verb)) {\n    return false;\n  }\n  const verb = VISIBLE_ACTIVITY_VERBS[activity.verb];\n\n  if (verb.objectTypes) {\n    if (verb.objectTypes.indexOf(activity.object.objectType) === -1) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","import {createSelector} from 'reselect';\nimport moment from 'moment';\nimport {filterSync} from '@webex/helper-html';\nimport {\n  ITEM_TYPE_ACTIVITY,\n  ITEM_TYPE_DAY_SEPARATOR,\n  ITEM_TYPE_NEW_MESSAGE_SEPARATOR\n} from '@webex/react-component-activity-list';\nimport {getActivitiesFromThreadAndNonThreadCollections} from '@webex/redux-module-conversation';\n\nimport defaultFormatters from './formatters';\nimport {isActivityVisible, isReplyActivity} from './helpers';\n\nconst getConversationThreadActivities = (state) => state.conversation.get('threadActivities');\nconst getConversationNonThreadActivities = (state) => state.conversation.get('sortNonThreadActivities');\nconst getConversationActivities = createSelector(\n  [\n    getConversationThreadActivities,\n    getConversationNonThreadActivities\n  ],\n  getActivitiesFromThreadAndNonThreadCollections\n);\nconst getAvatar = (state) => state.avatar;\nconst getUsers = (state) => state.users;\nconst getFlags = (state) => state.flags.get('flags');\nconst getSendingActivities = (state) => state.activity;\nconst getActivityFormatter = (state, props) => props.activityFormatter;\nconst getLastAcknowledgedActivityId = (state) => state.conversation.get('lastAcknowledgedActivityId');\nconst getOnEvent = (state, props) => props.onEvent;\n\n\n/**\n * Applies safe filters activity content\n *\n * @param {Object} activityObject raw activity.object\n * @returns {Object}\n */\n\nexport function filterActivity(activityObject) {\n  const outputActivity = Object.assign({}, activityObject);\n\n  if (outputActivity.content) {\n    outputActivity.content = filterSync(() => {}, {\n      'spark-mention': ['data-object-type', 'data-object-id', 'data-object-url'],\n      a: ['href'],\n      b: [],\n      blockquote: ['class'],\n      strong: [],\n      i: [],\n      em: [],\n      pre: [],\n      code: ['class'],\n      br: [],\n      hr: [],\n      p: [],\n      ul: [],\n      ol: [],\n      li: [],\n      h1: [],\n      h2: [],\n      h3: [],\n      h4: [],\n      h5: [],\n      h6: []\n    }, [], outputActivity.content);\n  }\n\n  return outputActivity;\n}\n\n/**\n * Applies additional formatting to activity\n *\n * @export\n * @param {Object} activityObject\n * @returns {Object}\n */\n\nexport function formatActivity(activity, activityFormatter, onEvent) {\n  const activityObject = filterActivity(activity);\n\n  if (typeof activityFormatter === 'function') {\n    return activityFormatter(activityObject, defaultFormatters, onEvent);\n  }\n\n  return defaultFormatters(activityObject, onEvent);\n}\n\n/**\n * This loops through our conversation activities and computes an array\n * of 'visible activities' to be used with the ActivityList component\n */\nexport const getActivityList = createSelector(\n  [\n    getConversationActivities,\n    getAvatar,\n    getUsers,\n    getSendingActivities,\n    getFlags,\n    getLastAcknowledgedActivityId,\n    getActivityFormatter,\n    getOnEvent\n  ],\n  (\n    conversationActivities,\n    avatar,\n    users,\n    sendingActivities,\n    flags,\n    lastAcknowledgedActivityId,\n    activityFormatter,\n    onEvent\n  ) => {\n    const avatars = avatar.get('items');\n    const currentUser = users.getIn(['byId', users.get('currentUserId')]);\n    const inFlightActivities = sendingActivities.get('inFlightActivities');\n    const activityFailures = sendingActivities.get('activityFailures');\n    const visibleActivityList = [];\n    const now = moment();\n    let lastActorId, lastVerb;\n    const lastActivity = {};\n    let shouldDisplayNewMessageMarker = false;\n\n    conversationActivities.forEach((activity) => {\n      if (isActivityVisible(activity)) {\n        // Insert day separator if this activity and last one happen on a different day\n        const activityDay = moment(activity.published, moment.ISO_8601).endOf('day');\n        const activityMinute = moment(activity.published, moment.ISO_8601).endOf('minute');\n\n        const lastDay = lastActivity.day;\n        const lastMinute = lastActivity.minute;\n        const sameDay = activityDay.diff(lastDay, 'days') === 0;\n        const sameMinute = activityMinute.diff(lastMinute, 'minutes') === 0;\n        const isReply = isReplyActivity(activity);\n\n        if (!isReply && lastDay && !sameDay) {\n          visibleActivityList.push({\n            type: ITEM_TYPE_DAY_SEPARATOR,\n            fromDate: lastDay,\n            key: `day-separtor-${activity.id}`,\n            now,\n            toDate: activityDay\n          });\n        }\n\n        if (!isReply) {\n          lastActivity.day = activityDay;\n        }\n        lastActivity.minute = activityMinute;\n        lastActivity.isReply = isReply;\n\n        // New message marker\n        if (shouldDisplayNewMessageMarker) {\n          visibleActivityList.push({\n            type: ITEM_TYPE_NEW_MESSAGE_SEPARATOR,\n            key: `new-messages-${activity.id}`\n          });\n          shouldDisplayNewMessageMarker = false;\n        }\n\n        // Actual visible activity item\n        // additional items don't repeat user avatar and name\n        const isAdditional = sameDay && sameMinute && lastActorId === activity.actor.id && lastVerb === activity.verb;\n\n        lastActorId = activity.actor.id;\n        lastVerb = activity.verb;\n\n        const isFlagged = !!flags.count() && flags.has(activity.url);\n        const isFlagPending = isFlagged && flags.getIn([activity.url, 'isInFlight']);\n\n        let formattedActivity = activity;\n\n        if (activity.verb === 'post') {\n          formattedActivity = Object.assign({}, activity, {\n            object: formatActivity(activity.object, activityFormatter, onEvent)\n          });\n        }\n\n        // Name of the user\n        let name = activity.actor.displayName;\n\n        if (activity.verb === 'add' || activity.verb === 'leave') {\n          name = activity.object.displayName;\n        }\n\n        const visibleActivity = {\n          currentUser,\n          type: ITEM_TYPE_ACTIVITY,\n          activity: formattedActivity,\n          avatarUrl: avatars.get(activity.actor.id),\n          isAdditional,\n          isFlagged,\n          isFlagPending,\n          isSelf: currentUser.id === activity.actor.id,\n          name\n        };\n\n        visibleActivityList.push(visibleActivity);\n\n        // Check if this is the last read activity\n        const isLastAcked = lastAcknowledgedActivityId && lastAcknowledgedActivityId === activity.id;\n        const isNotSelf = currentUser.id !== activity.actor.id;\n\n        if (isLastAcked && isNotSelf) {\n          shouldDisplayNewMessageMarker = true;\n        }\n      }\n    });\n\n    // Create a \"fake\" activity to display in flight activities\n    inFlightActivities.forEach((inFlightActivity) => {\n      visibleActivityList.push({\n        currentUser,\n        type: ITEM_TYPE_ACTIVITY,\n        activity: inFlightActivity,\n        avatarUrl: avatars.get(currentUser.id),\n        isAdditional: false,\n        isFlagged: false,\n        isFlagPending: false,\n        isSelf: true,\n        isPending: true\n      });\n    });\n\n    // Create a \"fake\" activity to display failed activities\n    activityFailures.forEach((activityFailure) => {\n      visibleActivityList.push({\n        currentUser,\n        type: ITEM_TYPE_ACTIVITY,\n        activity: activityFailure,\n        avatarUrl: avatars.get(currentUser.id),\n        isAdditional: false,\n        hasError: true,\n        isFlagged: false,\n        isFlagPending: false,\n        isSelf: true,\n        isPending: true\n      });\n    });\n\n    return visibleActivityList;\n  }\n);\n","import PropTypes from 'prop-types';\nimport {connect} from 'react-redux';\nimport ActivityListComponent from '@webex/react-component-activity-list';\n\nimport {getActivityList} from './selectors';\n\nfunction mapStateToProps(state, props) {\n  return Object.assign({}, props, {\n    activities: getActivityList(state, props)\n  });\n}\n\nconst ActivityList = connect(mapStateToProps)(ActivityListComponent);\n\nconst injectedPropTypes = {\n  activities: PropTypes.array\n};\n\nActivityList.propTypes = {\n  activityFormatter: PropTypes.func,\n  newMessagesMessage: PropTypes.string.isRequired,\n  onActivityDelete: PropTypes.func.isRequired,\n  onActivityFlag: PropTypes.func.isRequired,\n  onActivityRetry: PropTypes.func.isRequired,\n  ...injectedPropTypes\n};\n\nexport default ActivityList;\n"],"names":["activity","linkifyOptions","ignoreTags","className","content","Object","assign","linkifyHtml","linkifyStr","displayName","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","EVENT_NAME_MENTION_CLICKED","propTypes","PropTypes","string","onEvent","func","defaultProps","AtMentionComponent","isMention","target","tagName","dataset","triggerEvent","e","objectType","id","constructHydraId","objectId","handleClick","handleKeyUp","keyCode","classNames","styles","atMention","__html","mentions","component","items","formatters","linkify","result","forEach","formatter","REPLY_TYPE","isReplyActivity","parent","VISIBLE_ACTIVITY_VERBS","tombstone","share","objectTypes","post","create","update","add","leave","LYRA_SPACE_TYPE","isActivityVisible","object","prototype","hasOwnProperty","call","verb","indexOf","getConversationThreadActivities","state","conversation","get","getConversationNonThreadActivities","getConversationActivities","createSelector","getActivitiesFromThreadAndNonThreadCollections","getAvatar","avatar","getUsers","users","getFlags","flags","getSendingActivities","getActivityFormatter","props","activityFormatter","getLastAcknowledgedActivityId","getOnEvent","filterActivity","activityObject","outputActivity","filterSync","a","b","blockquote","strong","i","em","pre","code","br","hr","p","ul","ol","li","h1","h2","h3","h4","h5","h6","formatActivity","defaultFormatters","getActivityList","conversationActivities","sendingActivities","lastAcknowledgedActivityId","avatars","currentUser","getIn","inFlightActivities","activityFailures","visibleActivityList","now","moment","lastActorId","lastVerb","lastActivity","shouldDisplayNewMessageMarker","activityDay","published","ISO_8601","endOf","activityMinute","lastDay","day","lastMinute","minute","sameDay","diff","sameMinute","isReply","push","ITEM_TYPE_DAY_SEPARATOR","fromDate","key","toDate","ITEM_TYPE_NEW_MESSAGE_SEPARATOR","isAdditional","actor","isFlagged","count","has","url","isFlagPending","formattedActivity","name","visibleActivity","ITEM_TYPE_ACTIVITY","avatarUrl","isSelf","isLastAcked","isNotSelf","inFlightActivity","isPending","activityFailure","hasError","mapStateToProps","activities","ActivityList","connect","ActivityListComponent","injectedPropTypes","array","newMessagesMessage","isRequired","onActivityDelete","onActivityFlag","onActivityRetry"],"mappings":"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"}