{"version":3,"file":"index.js","sources":["../src/helpers.js","../src/actions.js","../src/reducer.js","../src/sdk.js","../src/component.js","../../../../../node_modules/style-inject/dist/style-inject.es.js","../src/inject-spark.js"],"sourcesContent":["/* eslint-disable import/prefer-default-export */\n\n/**\n * Gets the status booleans from different parts of the SDK instance\n *\n * @export\n * @param {Object} sdkInstance\n * @returns {Object} status\n * @returns {boolean} status.authenticated\n * @returns {boolean} status.authenticating\n * @returns {boolean} status.registered\n */\nexport function getStatusFromInstance(sdkInstance) {\n  return {\n    authenticated: sdkInstance.canAuthorize,\n    authenticating: sdkInstance.isAuthenticating,\n    registered: sdkInstance.internal.device.registered\n  };\n}\n","import {getStatusFromInstance} from './helpers';\n\nexport const REGISTER_DEVICE_FAILURE = 'spark/REGISTER_DEVICE_FAILURE';\nexport const UNREGISTER_DEVICE_FAILURE = 'spark/UNREGISTER_DEVICE_FAILURE';\nexport const STORE_SPARK_INSTANCE = 'spark/STORE_SPARK_INSTANCE';\nexport const UPDATE_SPARK_STATUS = 'spark/UPDATE_SPARK_STATUS';\nexport const STORE_SPARK_ADAPTOR = 'spark/STORE_SPARK_ADAPTOR';\n\nfunction registerDeviceFailure(error) {\n  return {\n    type: REGISTER_DEVICE_FAILURE,\n    payload: {\n      error\n    }\n  };\n}\n\nfunction unregisterDeviceFailure(error) {\n  return {\n    type: UNREGISTER_DEVICE_FAILURE,\n    payload: {\n      error\n    }\n  };\n}\n\nexport function updateSparkStatus(status) {\n  return {\n    type: UPDATE_SPARK_STATUS,\n    payload: {\n      status\n    }\n  };\n}\n\n\nexport function storeSparkInstance(spark) {\n  return {\n    type: STORE_SPARK_INSTANCE,\n    payload: {\n      status: getStatusFromInstance(spark),\n      spark\n    }\n  };\n}\n\nexport const storeSparkAdaptor = (adaptor) => ({\n  type: STORE_SPARK_ADAPTOR,\n  payload: {\n    adaptor\n  }\n});\n\nexport function registerDevice(spark) {\n  return (dispatch) => {\n    dispatch(updateSparkStatus({registering: true}));\n\n    return spark.internal.device.register()\n      .then(() => dispatch(updateSparkStatus({registering: false, registered: true})))\n      .catch((error) => dispatch(registerDeviceFailure(error)));\n  };\n}\n\n\nexport function unregisterDevice(spark) {\n  return (dispatch) => {\n    dispatch(updateSparkStatus({unregistering: true}));\n\n    return spark.internal.device.unregister()\n      .then(() => dispatch(updateSparkStatus({unregistering: false, registered: false})))\n      .catch((error) => dispatch(unregisterDeviceFailure(error)));\n  };\n}\n","import {fromJS, Record} from 'immutable';\n\nimport {\n  REGISTER_DEVICE_FAILURE,\n  UNREGISTER_DEVICE_FAILURE,\n  STORE_SPARK_INSTANCE,\n  STORE_SPARK_ADAPTOR,\n  UPDATE_SPARK_STATUS\n} from './actions';\n\nconst Status = Record({\n  authenticated: false,\n  authenticating: false,\n  registered: false,\n  registerError: false,\n  registering: false,\n  unregisterError: false,\n  unregistering: false\n});\n\nexport const initialState = fromJS({\n  error: null,\n  spark: null,\n  status: new Status()\n});\n\nexport default function reducer(state = initialState, action) {\n  switch (action.type) {\n    case UPDATE_SPARK_STATUS:\n      return state.mergeDeep({\n        status: action.payload.status\n      });\n\n    case STORE_SPARK_INSTANCE:\n      return state.set('spark', action.payload.spark)\n        .mergeDeep({\n          status: action.payload.status\n        });\n\n    case STORE_SPARK_ADAPTOR:\n      return state.set('adaptor', action.payload.adaptor);\n\n    case REGISTER_DEVICE_FAILURE:\n      return state.set('error', fromJS(action.payload.error))\n        .setIn(['status', 'registerError'], true)\n        .setIn(['status', 'registering'], false);\n\n    case UNREGISTER_DEVICE_FAILURE:\n      return state.set('error', fromJS(action.payload.error))\n        .setIn(['status', 'unregisterError'], true)\n        .setIn(['status', 'unregistering'], false);\n\n    default:\n      return state;\n  }\n}\n","import '@webex/plugin-logger';\nimport '@webex/plugin-authorization';\nimport '@webex/internal-plugin-mercury';\nimport '@webex/plugin-people';\nimport '@webex/internal-plugin-conversation';\nimport '@webex/plugin-phone';\nimport '@webex/plugin-rooms';\nimport '@webex/plugin-meetings';\nimport '@webex/internal-plugin-flag';\nimport '@webex/internal-plugin-feature';\nimport '@webex/internal-plugin-presence';\nimport '@webex/internal-plugin-search';\nimport '@webex/internal-plugin-team';\nimport Webex from '@webex/webex-core';\nimport LocalForageStoreAdapter from '@webex/storage-adapter-local-forage';\n\n/**\n * Evaluates the federation environment variable so that\n * it can be used to configure federation.\n * @returns {boolean} whether to configure federation\n */\nfunction configureFederation() {\n  const fed = process.env.FEDERATION;\n\n  if (fed && (fed === '0' || fed.toLowerCase() === 'false')) {\n    return false;\n  }\n\n  // Federation is on by default.\n  return true;\n}\n\n/**\n * Creates the default sdk config for the widgets\n * @param {Object} [options={}]\n * @returns {Object}\n */\nfunction defaultConfig(options = {}) {\n  return {\n    appName: 'webex-widgets',\n    appVersion: process.env.REACT_WEBEX_VERSION,\n    device: {\n      ephemeral: true\n    },\n    logger: {\n      level: options.logLevel || process.env.NODE_ENV === 'production' ? 'silent' : 'trace'\n    },\n    conversation: {\n      allowedInboundTags: {\n        'spark-mention': ['data-object-type', 'data-object-id', 'data-object-url'],\n        a: ['href'],\n        b: [],\n        blockquote: ['class'],\n        strong: [],\n        i: [],\n        em: [],\n        pre: [],\n        code: [],\n        br: [],\n        hr: [],\n        p: [],\n        ul: [],\n        ol: [],\n        li: [],\n        h1: [],\n        h2: [],\n        h3: []\n      },\n      allowedOutboundTags: {\n        'spark-mention': ['data-object-type', 'data-object-id', 'data-object-url'],\n        a: ['href'],\n        b: [],\n        blockquote: ['class'],\n        strong: [],\n        i: [],\n        em: [],\n        pre: [],\n        code: [],\n        br: [],\n        hr: [],\n        p: [],\n        ul: [],\n        ol: [],\n        li: [],\n        h1: [],\n        h2: [],\n        h3: []\n      }\n    },\n    credentials: {\n      client_id: process.env.WEBEX_CLIENT_ID,\n      federation: configureFederation(),\n      scope: 'spark:all spark:kms'\n    },\n    // Added to help load blocking during decryption\n    encryption: {\n      kmsInitialTimeout: 10000\n    },\n    meetings: {\n      deviceType: 'WEB'\n    },\n    phone: {\n      enableExperimentalGroupCallingSupport: true\n    },\n    storage: {\n      unboundedAdapter: new LocalForageStoreAdapter('webex-react-widgets')\n    }\n  };\n}\n\n\n/**\n * Creates a sdk instance with the access token\n * @param {string} accessToken\n * @param {object} options\n * @returns {Promise<object>}\n */\nexport function createSDKInstance(accessToken, options = {}) {\n  const webexSDKInstance = new Webex({\n    credentials: {\n      authorization: {\n        access_token: accessToken\n      }\n    },\n    config: defaultConfig(options)\n  });\n\n  return Promise.resolve(webexSDKInstance);\n}\n\n/**\n * Creates a webex instance with the jwt token generated\n * by a guest issuer.\n * https://developer.webex.com/docs/guest-issuer\n *\n * @param {string} jwt\n * @param {object} options\n * @returns {Promise<object>}\n */\nexport function createSDKGuestInstance(jwt, options = {}) {\n  const webexSDKInstance = new Webex({\n    config: defaultConfig(options)\n  });\n\n  return webexSDKInstance.authorization.requestAccessTokenFromJwt({jwt}).then(() => webexSDKInstance);\n}\n","import {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {bindActionCreators} from 'redux';\nimport {connect} from 'react-redux';\nimport {addError} from '@webex/redux-module-errors';\n\nimport WebexSDKAdapter from '@webex/sdk-component-adapter';\n\nimport {\n  updateSparkStatus,\n  registerDevice,\n  storeSparkInstance,\n  storeSparkAdaptor\n} from './actions';\nimport {createSDKGuestInstance, createSDKInstance} from './sdk';\nimport {getStatusFromInstance} from './helpers';\n\nconst injectedPropTypes = {\n  spark: PropTypes.object.isRequired,\n  storeSparkInstance: PropTypes.func.isRequired,\n  storeSparkAdaptor: PropTypes.func.isRequired,\n  updateSparkStatus: PropTypes.func.isRequired,\n  addError: PropTypes.func.isRequired\n};\n\nconst propTypes = {\n  accessToken: PropTypes.string,\n  guestToken: PropTypes.string,\n  sdkInstance: PropTypes.object,\n  dangerouslyIgnoredRequiredPlugins: PropTypes.array,\n  ...injectedPropTypes\n};\n\nconst defaultProps = {\n  accessToken: '',\n  guestToken: '',\n  sdkInstance: undefined,\n  dangerouslyIgnoredRequiredPlugins: []\n};\n\nconst PLUGINS = ['authorization', 'logger', 'meetings', 'people', 'phone', 'rooms'];\nconst INTERNAL_PLUGINS = ['conversation', 'feature', 'flag', 'mercury', 'presence', 'search', 'team'];\n\nconst storeSDKAdaptor = async (sdk, props) => {\n  const a = new WebexSDKAdapter(sdk);\n\n  await a.meetingsAdapter.connect();\n\n  props.storeSparkAdaptor(a);\n};\n\nexport class SparkComponent extends Component {\n  constructor(props) {\n    super(props);\n\n    this.storeSDKInstance = this.storeSDKInstance.bind(this);\n  }\n\n  componentDidMount() {\n    const {\n      accessToken,\n      guestToken,\n      spark,\n      sdkInstance\n    } = this.props;\n\n    // Get the sdk instance from redux state\n    const sparkInstance = spark.get('spark');\n\n    // No instance stored, let's get one\n    if (!sparkInstance) {\n      // SDK Instance passed via props\n      if (sdkInstance) {\n        this.storeSDKInstance(sdkInstance);\n      }\n      // Guest token passed via props\n      else if (guestToken) {\n        createSDKGuestInstance(guestToken, this.props).then(this.storeSDKInstance);\n      }\n      // Access token passed via props\n      else if (accessToken) {\n        createSDKInstance(accessToken, this.props).then(this.storeSDKInstance);\n      }\n      else {\n        // No valid options to create an sdk instance, throw an error\n        this.props.addError({\n          id: 'webex-sdk-config-props',\n          displayTitle: 'Something\\'s not right. Please try again',\n          displaySubtitle: 'Missing initial configuration, please pass \\'sdkInstance\\', \\'accessToken\\', or \\'guestToken\\'',\n          temporary: false\n        });\n      }\n    }\n    else {\n      this.listenToSparkEvents(sparkInstance);\n    }\n  }\n\n  /**\n   * Register the device if the user has been authenticated\n   * and the device is not registered yet.\n   * @param {Object} sparkInstance\n   */\n  setupDevice(sparkInstance) {\n    const {\n      registering,\n      registerError\n    } = this.props.spark.get('status');\n\n    const {\n      authenticated,\n      registered\n    } = getStatusFromInstance(sparkInstance);\n\n    if (authenticated && !registered && !registering && !registerError) {\n      this.props.registerDevice(sparkInstance);\n    }\n  }\n\n  /**\n   * Listen to any new events and update the sprak instance\n   * status accordingly\n   * @param {Object} sparkInstance\n   */\n  listenToSparkEvents(sparkInstance) {\n    sparkInstance.listenToAndRun(sparkInstance, 'change:canAuthorize', () => {\n      this.props.updateSparkStatus({authenticated: sparkInstance.canAuthorize});\n    });\n\n    sparkInstance.listenToAndRun(sparkInstance, 'change:isAuthenticating', () => {\n      this.props.updateSparkStatus({authenticating: sparkInstance.isAuthenticating});\n    });\n\n    sparkInstance.listenToAndRun(sparkInstance.internal.device, 'change:registered', () => {\n      this.props.updateSparkStatus({registered: sparkInstance.internal.device.registered});\n    });\n\n    this.setupDevice(sparkInstance);\n  }\n\n  /**\n   * Verify for the plugins, store the spark instance\n   * and listen to any events\n   * @param {Object} sdkInstance\n   */\n  storeSDKInstance(sdkInstance) {\n    if (this.validateSDKInstance(sdkInstance)) {\n      this.props.storeSparkInstance(sdkInstance);\n      this.listenToSparkEvents(sdkInstance);\n      storeSDKAdaptor(sdkInstance, this.props);\n    }\n  }\n\n  /**\n   * Validates the sdk instance object and plugins\n   *\n   * @param {Object} sdkInstance\n   * @returns {boolean}\n   * @memberof SparkComponent\n   */\n  validateSDKInstance(sdkInstance) {\n    if (typeof sdkInstance !== 'object') {\n      this.props.addError({\n        id: 'webex-sdk-instance-prop',\n        displayTitle: 'Something\\'s not right. Please try again',\n        displaySubtitle: 'The \\'sdkInstance\\' passed was invalid. Please pass a proper SDK Instance.',\n        temporary: false\n      });\n\n      return false;\n    }\n\n    return this.verifyPlugins(sdkInstance);\n  }\n\n  /**\n   * Verify if all the plugins have been injected\n   * properly to the webex SDK instance\n   * @param {Object} sdkInstance\n   * @returns {boolean}\n   */\n  verifyPlugins(sdkInstance) {\n    let contains = false;\n    let verified = true;\n\n    for (const plugin of PLUGINS) {\n      if (!this.props.dangerouslyIgnoredRequiredPlugins.includes(plugin)) {\n        contains = Object.prototype.hasOwnProperty.call(sdkInstance, plugin);\n\n        if (!contains) {\n          this.props.addError({\n            id: 'webex-plugins-missing',\n            displayTitle: 'Something\\'s not right. Please try again',\n            displaySubtitle: `Webex SDK instance plugin ${plugin} is not injected to the widget properly`,\n            temporary: false\n          });\n          verified = false;\n        }\n      }\n    }\n\n    for (const internalPlugin of INTERNAL_PLUGINS) {\n      if (!this.props.dangerouslyIgnoredRequiredPlugins.includes(internalPlugin)) {\n        contains = Object.prototype.hasOwnProperty.call(sdkInstance.internal, internalPlugin);\n\n        if (!contains) {\n          this.props.addError({\n            id: 'webex-internal-plugins-missing',\n            displayTitle: 'Something\\'s not right. Please try again',\n            displaySubtitle: `Webex SDK instance internal plugin ${internalPlugin} is not injected to the widget properly`,\n            temporary: false\n          });\n          verified = false;\n        }\n      }\n    }\n\n    return verified;\n  }\n\n  render() {\n    return null;\n  }\n}\n\nSparkComponent.propTypes = propTypes;\nSparkComponent.defaultProps = defaultProps;\n\nexport default connect(\n  (state) => ({\n    spark: state.spark\n  }),\n  (dispatch) => bindActionCreators({\n    updateSparkStatus,\n    registerDevice,\n    storeSparkInstance,\n    storeSparkAdaptor,\n    addError\n  }, dispatch)\n)(SparkComponent);\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport {wrapDisplayName} from 'recompose';\n\nimport SparkComponent from './component';\n\nimport styles from './styles.css';\n\nconst propTypes = {\n  accessToken: PropTypes.string,\n  guestToken: PropTypes.string\n};\n\nconst defaultProps = {\n  accessToken: '',\n  guestToken: ''\n};\n\nexport default function injectSpark(BaseComponent) {\n  function WithSpark(props) {\n    return (\n      <div className={styles.wrapper}>\n        <SparkComponent {...props} />\n        <BaseComponent {...props} />\n      </div>\n    );\n  }\n  WithSpark.propTypes = propTypes;\n  WithSpark.defaultProps = defaultProps;\n  WithSpark.displayName = wrapDisplayName(BaseComponent, 'WithSpark');\n\n  return WithSpark;\n}\n\nexport const withSpark = injectSpark;\n"],"names":["getStatusFromInstance","sdkInstance","authenticated","canAuthorize","authenticating","isAuthenticating","registered","internal","device","REGISTER_DEVICE_FAILURE","UNREGISTER_DEVICE_FAILURE","STORE_SPARK_INSTANCE","UPDATE_SPARK_STATUS","STORE_SPARK_ADAPTOR","registerDeviceFailure","error","type","payload","updateSparkStatus","status","storeSparkInstance","spark","storeSparkAdaptor","adaptor","registerDevice","dispatch","registering","register","then","catch","Status","Record","registerError","unregisterError","unregistering","initialState","fromJS","reducer","state","action","mergeDeep","set","setIn","configureFederation","fed","process","env","FEDERATION","toLowerCase","defaultConfig","options","appName","appVersion","REACT_WEBEX_VERSION","ephemeral","logger","level","logLevel","NODE_ENV","conversation","allowedInboundTags","a","b","blockquote","strong","i","em","pre","code","br","hr","p","ul","ol","li","h1","h2","h3","allowedOutboundTags","credentials","client_id","WEBEX_CLIENT_ID","federation","scope","encryption","kmsInitialTimeout","meetings","deviceType","phone","enableExperimentalGroupCallingSupport","storage","unboundedAdapter","LocalForageStoreAdapter","createSDKInstance","accessToken","webexSDKInstance","Webex","authorization","access_token","config","Promise","resolve","createSDKGuestInstance","jwt","requestAccessTokenFromJwt","injectedPropTypes","PropTypes","object","isRequired","func","addError","propTypes","string","guestToken","dangerouslyIgnoredRequiredPlugins","array","defaultProps","undefined","PLUGINS","INTERNAL_PLUGINS","storeSDKAdaptor","sdk","props","WebexSDKAdapter","meetingsAdapter","connect","SparkComponent","Component","constructor","storeSDKInstance","bind","componentDidMount","sparkInstance","get","id","displayTitle","displaySubtitle","temporary","listenToSparkEvents","setupDevice","listenToAndRun","validateSDKInstance","verifyPlugins","contains","verified","plugin","includes","Object","prototype","hasOwnProperty","call","internalPlugin","render","bindActionCreators","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","injectSpark","BaseComponent","WithSpark","styles","wrapper","displayName","wrapDisplayName","withSpark"],"mappings":"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"}