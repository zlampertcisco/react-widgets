{"version":3,"file":"index.js","sources":["../src/helpers.js","../src/actions.js","../src/reducer.js"],"sourcesContent":["import {\n  MENTION_NOTIFICATIONS_ON,\n  MENTION_NOTIFICATIONS_OFF,\n  MESSAGE_NOTIFICATIONS_ON,\n  MESSAGE_NOTIFICATIONS_OFF,\n  SPACE_TYPE_ONE_ON_ONE,\n  SPACE_TYPE_GROUP,\n  deconstructHydraId\n} from '@webex/react-component-utils';\n\nconst TAG_ONE_ON_ONE = 'ONE_ON_ONE';\nconst TAG_HIDDEN = 'HIDDEN';\n\nexport const TAG_LOCKED = 'LOCKED';\n\nexport function constructLastestActivity(items) {\n  const latest = items.find((item) => ['tombstone', 'delete'].indexOf(item.verb) === -1);\n\n  return latest;\n}\n\n/**\n * Creates team object to be stored\n *\n * @param {Object} space\n * @param {Bool} isDecrypting\n * @returns {Object} formatted space object\n */\nexport function constructSpace(space) {\n  const latestActivity = constructLastestActivity(space.activities.items);\n  const s = {\n    avatar: space.avatar,\n    displayName: space.displayName || space.computedTitle,\n    id: space.id,\n    url: space.url,\n    globalId: space.globalId,\n    locusUrl: space.locusUrl,\n    activities: space.activities.items.map((a) => a.id),\n    lastReadableActivityDate: space.lastReadableActivityDate,\n    lastSeenActivityDate: space.lastSeenActivityDate,\n    conversationWebUrl: space.conversationWebUrl,\n    participants: space.participants.items,\n    type: space.tags.includes(TAG_ONE_ON_ONE) ? SPACE_TYPE_ONE_ON_ONE : SPACE_TYPE_GROUP,\n    published: space.published,\n    tags: space.tags,\n    isDecrypting: space.isDecrypting,\n    isHidden: space.tags.includes(TAG_HIDDEN),\n    isLocked: space.tags.includes(TAG_LOCKED),\n    isMentionNotificationsOn: space.tags && space.tags.includes(MENTION_NOTIFICATIONS_ON) ? true : undefined,\n    isMentionNotificationsOff: space.tags && space.tags.includes(MENTION_NOTIFICATIONS_OFF) ? true : undefined,\n    isMessageNotificationsOn: space.tags && space.tags.includes(MESSAGE_NOTIFICATIONS_ON) ? true : undefined,\n    isMessageNotificationsOff: space.tags && space.tags.includes(MESSAGE_NOTIFICATIONS_OFF) ? true : undefined\n  };\n\n  // Left spaces will still show up sometimes with empty activities\n  if (!space.lastReadableActivityDate && space.published) {\n    s.lastReadableActivityDate = space.published;\n  }\n\n  if (latestActivity) {\n    s.latestActivity = latestActivity.id;\n  }\n\n  if (space.team) {\n    s.team = space.team.id;\n  }\n\n  return s;\n}\n\nexport function constructSpaces(spaces) {\n  return spaces.map((space) => constructSpace(space));\n}\n\n\n/**\n * Converts a hydra room object to a conversation space object\n * (as much as possible)\n *\n * @param {object} room\n * @param {string} room.id ex: \"Y2lzY29zcGFyazovL3VzL1JPT00vYmJjZWIxYWQtNDNmMS0zYjU4LTkxNDctZjE0YmIwYzRkMTU0\"\n * @param {string} room.title ex: \"Project Unicorn - Sprint 0\"\n * @param {string} room.type ex: \"group\"\n * @param {string} room.isLocked ex: true\n * @param {string} room.teamId ex: \"Y2lzY29zcGFyazovL3VzL1JPT00vNjRlNDVhZTAtYzQ2Yi0xMWU1LTlkZjktMGQ0MWUzNDIxOTcz\"\n * @param {string} room.lastActivity ex: \"2016-04-21T19:12:48.920Z\"\n * @param {string} room.creatorId ex: \"Y2lzY29zcGFyazovL3VzL1BFT1BMRS9mNWIzNjE4Ny1jOGRkLTQ3MjctOGIyZi1mOWM0NDdmMjkwNDY\"\n * @param {string} room.created ex: \"2016-04-21T19:01:55.966Z\n *\n * @returns {object} converted space object\n */\nexport function constructSpaceFromHydraRoom(room) {\n  const {id: globalId} = room;\n  const {id, cluster} = deconstructHydraId(globalId);\n  const team = room.teamId ? {id: deconstructHydraId(room.teamId).id} : '';\n  const type = room.type === 'direct' ? SPACE_TYPE_ONE_ON_ONE : SPACE_TYPE_GROUP;\n  const tags = room.isLocked ? [TAG_LOCKED] : [];\n\n  return {\n    id,\n    cluster,\n    globalId,\n    type,\n    team,\n    tags,\n    displayName: room.title,\n    lastReadableActivityDate: room.lastActivity,\n    isDecrypting: false,\n    activities: {\n      items: []\n    },\n    participants: {\n      items: []\n    }\n  };\n}\n","import {addError} from '@webex/redux-module-errors';\nimport {storeActivities} from '@webex/redux-module-activities';\nimport {\n  createConversationBegin,\n  computeRoomProperties,\n  storeConversation\n} from '@webex/redux-module-conversation';\nimport {storeUsers} from '@webex/redux-module-users';\n\nimport {\n  TAG_LOCKED,\n  constructSpace,\n  constructSpaces,\n  constructSpaceFromHydraRoom\n} from './helpers';\n\nexport const STORE_SPACES = 'spaces/STORE_SPACES';\nexport const UPDATE_SPACE_WITH_ACTIVITY = 'spaces/UPDATE_SPACE_WITH_ACTIVITY';\nexport const UPDATE_SPACE_READ = 'spaces/UPDATE_SPACE_READ';\nexport const ADD_SPACE_TAGS = 'spaces/ADD_SPACE_TAGS';\nexport const REMOVE_SPACE_TAGS = 'spaces/REMOVE_SPACE_TAGS';\nexport const REMOVE_SPACE = 'spaces/REMOVE_SPACE';\nexport const STORE_SPACE = 'spaces/STORE_SPACE';\nexport const STORE_INITIAL_SPACE = 'spaces/STORE_INITIAL_SPACE';\n\n// The options to pass to convo service when fetching multiple spaces (for recents)\nconst spacesConversationOptions = {\n  personRefresh: false,\n  participantsLimit: 0,\n  activitiesLimit: 0,\n  computeTitleIfEmpty: true,\n  globalId: true,\n  paginate: true\n};\n\n/**\n * Updates the last seen date of a space\n * @param {String} spaceId\n * @param {String} lastSeenDate\n * @returns {Object}\n */\nexport function updateSpaceRead(spaceId, lastSeenDate) {\n  return {\n    type: UPDATE_SPACE_READ,\n    payload: {\n      lastSeenDate,\n      spaceId\n    }\n  };\n}\n\n/**\n * Adds to a space's tags with the provided array\n *\n * @export\n * @param {String} spaceId\n * @param {Array} tags\n * @returns {Object}\n */\nexport function addSpaceTags(spaceId, tags) {\n  return {\n    type: ADD_SPACE_TAGS,\n    payload: {\n      spaceId,\n      tags\n    }\n  };\n}\n\n/**\n * Removes from a space's tags the provided array\n *\n * @export\n * @param {String} spaceId\n * @param {Array} tags\n * @returns {Object}\n */\nexport function removeSpaceTags(spaceId, tags) {\n  return {\n    type: REMOVE_SPACE_TAGS,\n    payload: {\n      spaceId,\n      tags\n    }\n  };\n}\n\nexport function removeSpace(id) {\n  return {\n    type: REMOVE_SPACE,\n    payload: {\n      id\n    }\n  };\n}\n\n\nexport function storeSpaces(spaces) {\n  return {\n    type: STORE_SPACES,\n    payload: {\n      spaces: constructSpaces(spaces)\n    }\n  };\n}\n\nfunction storeInitialSpace(id) {\n  return {\n    type: STORE_INITIAL_SPACE,\n    payload: {\n      id\n    }\n  };\n}\n\n/**\n * Adds a rate limit error to the errors module\n * @param {function} dispatch\n * @param {String} name\n */\nfunction addLoadError(dispatch, name) {\n  dispatch(addError({\n    code: name,\n    id: 'redux-module-spaces-load',\n    displayTitle: 'Something\\'s not right',\n    displaySubtitle: `Unable to load spaces. Please try again later. [${name}]`,\n    temporary: false\n  }));\n}\n\nfunction decryptSpace(space) {\n  if (typeof space.decrypt === 'function') {\n    return space.decrypt()\n      .then((s) => Promise.resolve(s));\n  }\n\n  return Promise.resolve(new Error('Space cannot be decrypted'));\n}\n\n/**\n * Updates the target space with incoming Mercury activity\n *\n * @export\n * @param {Object} activity\n * @param {Boolean} isSelf if actor is the same as this user\n * @param {Boolean} isReadable if the activity is a readable activity\n * @returns {Object} action\n */\nexport function updateSpaceWithActivity(activity, isSelf, isReadable = false) {\n  // We update lastReadableActivityDate, and the activity attached to this Space\n  const space = {\n    id: activity.target.id,\n    latestActivity: activity.id,\n    isLocked: activity.object.tags && activity.object.tags.includes(TAG_LOCKED)\n  };\n\n  if (isSelf) {\n    space.lastSeenActivityDate = activity.published;\n  }\n\n  if (isReadable) {\n    space.lastReadableActivityDate = activity.published;\n  }\n\n  return {\n    type: UPDATE_SPACE_WITH_ACTIVITY,\n    payload: {\n      space\n    }\n  };\n}\n\n/**\n * Fetches single space from server\n *\n * @export\n * @param {Object} sparkInstance\n * @param {Object} space - represents the space to fetch.\n *   Contains a 'url' or an 'id' and 'cluster'\n * @returns {function} thunk\n */\nexport function fetchSpace(sparkInstance, space) {\n  return (dispatch) => {\n    dispatch(storeInitialSpace(space.id));\n    // This dispatch was moved here to maintain the legacy conversation redux\n    // store values for usage within 'widget-message'. This dispatch clears and\n    // initializes the redux store's 'conversation' value.\n    dispatch(createConversationBegin());\n\n    return sparkInstance.internal.conversation.get(space, {\n      activitiesLimit: 40,\n      participantsLimit: -1,\n      participantAckFilter: 'all',\n      includeParticipants: true,\n      globalId: true,\n      latestActivity: true\n    })\n      .then((fullSpace) => {\n        dispatch(storeUsers(fullSpace.participants.items));\n        dispatch(storeActivities(fullSpace.activities.items));\n        dispatch(storeSpaces([fullSpace]));\n\n        // This dispatch was moved here to maintain the legacy conversation\n        // redux store values for usage within 'widget-message'. This dispatch\n        // stores the conversation details in the redux store's 'conversation'\n        // value.\n        dispatch(storeConversation(\n          computeRoomProperties(fullSpace, sparkInstance)\n        ));\n\n        return Promise.resolve(constructSpace(fullSpace));\n      })\n      .catch((err) => {\n        addLoadError(dispatch, err.name);\n\n        throw (err);\n      });\n  };\n}\n\n/**\n * Fetches spaces encrypted, stores encrypted spaces, then decrypts them.\n * This provides a better first time UX due to the fact that users can\n * see the decryption progress of each space.\n *\n * @export\n * @param {object} sparkInstance\n * @param {object} [options={}]\n * @returns {function} thunk\n */\nexport function fetchSpacesEncrypted(sparkInstance, options = {}) {\n  const listOptions = Object.assign({deferDecrypt: true}, spacesConversationOptions, options);\n\n  return (dispatch) => sparkInstance.internal.conversation\n    .list(listOptions)\n    .then((items) => {\n      const spaces = items.map((space) => {\n        const decryptPromise = decryptSpace(space)\n          .then((decryptedSpace) => {\n            if (decryptedSpace) {\n              const s = Object.assign({}, decryptedSpace, {isDecrypting: false});\n\n              dispatch(storeSpaces([s]));\n\n              return Promise.resolve(constructSpace(s));\n            }\n\n            return Promise.resolve(new Error('Space was not decrypted correctly'));\n          });\n\n        return Object.assign({}, space, {\n          isDecrypting: true,\n          decryptPromise\n        });\n      });\n\n      dispatch(storeSpaces(spaces));\n\n      return Promise.resolve(spaces);\n    })\n    .catch((err) => {\n      addLoadError(dispatch, err.name);\n\n      throw (err);\n    });\n}\n\n/**\n * Fetches a list of spaces with options\n *\n * @export\n * @param {Object} sparkInstance\n * @param {Object} options\n * @returns {Function} thunk\n */\nexport function fetchSpaces(sparkInstance, options = {}) {\n  const listOptions = Object.assign({}, spacesConversationOptions, options);\n\n  return (dispatch) => sparkInstance.internal.conversation\n    .list(listOptions)\n    .then((spaces) => {\n      dispatch(storeSpaces(spaces));\n\n      const constructedSpaces = spaces.map(constructSpace);\n\n      return Promise.resolve(constructedSpaces);\n    })\n    .catch((err) => {\n      addLoadError(dispatch, err.name);\n\n      throw (err);\n    });\n}\n\nexport function fetchSpacesHydra(sparkInstance, options = {}) {\n  const defaultHydraOptions = {\n    max: 100,\n    sortBy: 'lastactivity'\n  };\n\n  const listOptions = Object.assign({}, defaultHydraOptions, options);\n\n  return (dispatch) => sparkInstance.rooms\n    .list(listOptions)\n    .then((rooms) => {\n      const spaces = rooms.items.map(constructSpaceFromHydraRoom);\n\n      dispatch(storeSpaces(spaces));\n\n      const constructedSpaces = spaces.map(constructSpace);\n\n      return Promise.resolve(constructedSpaces);\n    })\n    .catch((err) => {\n      addLoadError(dispatch, err.name);\n\n      throw (err);\n    });\n}\n","import {\n  fromJS,\n  Record\n} from 'immutable';\n\nimport {union} from 'lodash';\n\nimport {\n  ADD_SPACE_TAGS,\n  REMOVE_SPACE,\n  REMOVE_SPACE_TAGS,\n  STORE_SPACES,\n  STORE_INITIAL_SPACE,\n  UPDATE_SPACE_READ,\n  UPDATE_SPACE_WITH_ACTIVITY\n} from './actions';\n\nexport const Space = Record({\n  latestActivity: null,\n  avatar: '',\n  displayName: '',\n  id: null,\n  globalId: null,\n  url: '',\n  locusUrl: '',\n  activities: [],\n  lastReadableActivityDate: '',\n  lastSeenActivityDate: '',\n  lastActivityTimestamp: '',\n  conversationWebUrl: '',\n  participants: [],\n  type: '',\n  published: '',\n  tags: [],\n  team: null,\n  isDecrypting: false,\n  isLocked: false,\n  isHidden: false,\n  isFetching: false\n});\n\nexport const initialState = fromJS({\n  byId: {}\n});\n\n\nexport default function reducer(state = initialState, action) {\n  switch (action.type) {\n    case ADD_SPACE_TAGS: {\n      const {spaceId, tags} = action.payload;\n\n      if (state.hasIn(['byId', spaceId])) {\n        const originalTags = state.getIn(['byId', spaceId, 'tags']);\n\n        return state.setIn(['byId', spaceId, 'tags'], union(originalTags, tags));\n      }\n\n      return state;\n    }\n\n    case REMOVE_SPACE:\n      return state.deleteIn(['byId', action.payload.id]);\n\n    case REMOVE_SPACE_TAGS: {\n      const {spaceId, tags} = action.payload;\n\n      if (state.hasIn(['byId', spaceId])) {\n        const modifiedTags = state.getIn(['byId', spaceId, 'tags']);\n\n        tags.forEach((t) => {\n          const index = modifiedTags.indexOf(t);\n\n          if (index !== -1) {\n            modifiedTags.splice(index, 1);\n          }\n        });\n\n        return state.setIn(['byId', spaceId, 'tags'], modifiedTags);\n      }\n\n      return state;\n    }\n\n    case STORE_INITIAL_SPACE: {\n      const {id} = action.payload;\n\n      return state.setIn(['byId', id], new Space({\n        id,\n        isFetching: true\n      }));\n    }\n\n    case STORE_SPACES: {\n      const spaces = {};\n\n      action.payload.spaces.forEach((s) => {\n        spaces[s.id] = new Space(s);\n      });\n\n      return state.mergeDeepIn(['byId'], spaces);\n    }\n\n    case UPDATE_SPACE_WITH_ACTIVITY: {\n      const {space} = action.payload;\n\n      if (state.hasIn(['byId', space.id])) {\n        return state.mergeDeepIn(['byId', space.id], space);\n      }\n\n      return state;\n    }\n\n    case UPDATE_SPACE_READ: {\n      const {lastSeenDate, spaceId} = action.payload;\n\n      return state.setIn(['byId', spaceId, 'lastSeenActivityDate'], lastSeenDate);\n    }\n\n    default:\n      return state;\n  }\n}\n"],"names":["TAG_ONE_ON_ONE","TAG_HIDDEN","TAG_LOCKED","constructLastestActivity","items","latest","find","item","indexOf","verb","constructSpace","space","latestActivity","activities","s","avatar","displayName","computedTitle","id","url","globalId","locusUrl","map","a","lastReadableActivityDate","lastSeenActivityDate","conversationWebUrl","participants","type","tags","includes","SPACE_TYPE_ONE_ON_ONE","SPACE_TYPE_GROUP","published","isDecrypting","isHidden","isLocked","isMentionNotificationsOn","MENTION_NOTIFICATIONS_ON","undefined","isMentionNotificationsOff","MENTION_NOTIFICATIONS_OFF","isMessageNotificationsOn","MESSAGE_NOTIFICATIONS_ON","isMessageNotificationsOff","MESSAGE_NOTIFICATIONS_OFF","team","constructSpaces","spaces","constructSpaceFromHydraRoom","room","cluster","deconstructHydraId","teamId","title","lastActivity","STORE_SPACES","UPDATE_SPACE_WITH_ACTIVITY","UPDATE_SPACE_READ","ADD_SPACE_TAGS","REMOVE_SPACE_TAGS","REMOVE_SPACE","STORE_SPACE","STORE_INITIAL_SPACE","spacesConversationOptions","personRefresh","participantsLimit","activitiesLimit","computeTitleIfEmpty","paginate","updateSpaceRead","spaceId","lastSeenDate","payload","addSpaceTags","removeSpaceTags","removeSpace","storeSpaces","storeInitialSpace","addLoadError","dispatch","name","addError","code","displayTitle","displaySubtitle","temporary","decryptSpace","decrypt","then","Promise","resolve","Error","updateSpaceWithActivity","activity","isSelf","isReadable","target","object","fetchSpace","sparkInstance","createConversationBegin","internal","conversation","get","participantAckFilter","includeParticipants","fullSpace","storeUsers","storeActivities","storeConversation","computeRoomProperties","catch","err","fetchSpacesEncrypted","options","listOptions","Object","assign","deferDecrypt","list","decryptPromise","decryptedSpace","fetchSpaces","constructedSpaces","fetchSpacesHydra","defaultHydraOptions","max","sortBy","rooms","Space","Record","lastActivityTimestamp","isFetching","initialState","fromJS","byId","reducer","state","action","hasIn","originalTags","getIn","setIn","union","deleteIn","modifiedTags","forEach","t","index","splice","mergeDeepIn"],"mappings":";;;;;;;;AAUA,MAAMA,cAAc,GAAG,YAAvB;AACA,MAAMC,UAAU,GAAG,QAAnB;AAEO,MAAMC,UAAU,GAAG,QAAnB;AAEA,SAASC,wBAAT,CAAkCC,KAAlC,EAAyC;AAC9C,QAAMC,MAAM,GAAGD,KAAK,CAACE,IAAN,CAAYC,IAAD,IAAU,CAAC,WAAD,EAAc,QAAd,EAAwBC,OAAxB,CAAgCD,IAAI,CAACE,IAArC,MAA+C,CAAC,CAArE,CAAf;AAEA,SAAOJ,MAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASK,cAAT,CAAwBC,KAAxB,EAA+B;AACpC,QAAMC,cAAc,GAAGT,wBAAwB,CAACQ,KAAK,CAACE,UAAN,CAAiBT,KAAlB,CAA/C;AACA,QAAMU,CAAC,GAAG;AACRC,IAAAA,MAAM,EAAEJ,KAAK,CAACI,MADN;AAERC,IAAAA,WAAW,EAAEL,KAAK,CAACK,WAAN,IAAqBL,KAAK,CAACM,aAFhC;AAGRC,IAAAA,EAAE,EAAEP,KAAK,CAACO,EAHF;AAIRC,IAAAA,GAAG,EAAER,KAAK,CAACQ,GAJH;AAKRC,IAAAA,QAAQ,EAAET,KAAK,CAACS,QALR;AAMRC,IAAAA,QAAQ,EAAEV,KAAK,CAACU,QANR;AAORR,IAAAA,UAAU,EAAEF,KAAK,CAACE,UAAN,CAAiBT,KAAjB,CAAuBkB,GAAvB,CAA4BC,CAAD,IAAOA,CAAC,CAACL,EAApC,CAPJ;AAQRM,IAAAA,wBAAwB,EAAEb,KAAK,CAACa,wBARxB;AASRC,IAAAA,oBAAoB,EAAEd,KAAK,CAACc,oBATpB;AAURC,IAAAA,kBAAkB,EAAEf,KAAK,CAACe,kBAVlB;AAWRC,IAAAA,YAAY,EAAEhB,KAAK,CAACgB,YAAN,CAAmBvB,KAXzB;AAYRwB,IAAAA,IAAI,EAAEjB,KAAK,CAACkB,IAAN,CAAWC,QAAX,CAAoB9B,cAApB,IAAsC+B,qBAAtC,GAA8DC,gBAZ5D;AAaRC,IAAAA,SAAS,EAAEtB,KAAK,CAACsB,SAbT;AAcRJ,IAAAA,IAAI,EAAElB,KAAK,CAACkB,IAdJ;AAeRK,IAAAA,YAAY,EAAEvB,KAAK,CAACuB,YAfZ;AAgBRC,IAAAA,QAAQ,EAAExB,KAAK,CAACkB,IAAN,CAAWC,QAAX,CAAoB7B,UAApB,CAhBF;AAiBRmC,IAAAA,QAAQ,EAAEzB,KAAK,CAACkB,IAAN,CAAWC,QAAX,CAAoB5B,UAApB,CAjBF;AAkBRmC,IAAAA,wBAAwB,EAAE1B,KAAK,CAACkB,IAAN,IAAclB,KAAK,CAACkB,IAAN,CAAWC,QAAX,CAAoBQ,wBAApB,CAAd,GAA8D,IAA9D,GAAqEC,SAlBvF;AAmBRC,IAAAA,yBAAyB,EAAE7B,KAAK,CAACkB,IAAN,IAAclB,KAAK,CAACkB,IAAN,CAAWC,QAAX,CAAoBW,yBAApB,CAAd,GAA+D,IAA/D,GAAsEF,SAnBzF;AAoBRG,IAAAA,wBAAwB,EAAE/B,KAAK,CAACkB,IAAN,IAAclB,KAAK,CAACkB,IAAN,CAAWC,QAAX,CAAoBa,wBAApB,CAAd,GAA8D,IAA9D,GAAqEJ,SApBvF;AAqBRK,IAAAA,yBAAyB,EAAEjC,KAAK,CAACkB,IAAN,IAAclB,KAAK,CAACkB,IAAN,CAAWC,QAAX,CAAoBe,yBAApB,CAAd,GAA+D,IAA/D,GAAsEN;AArBzF,GAAV,CAFoC;;AA2BpC,MAAI,CAAC5B,KAAK,CAACa,wBAAP,IAAmCb,KAAK,CAACsB,SAA7C,EAAwD;AACtDnB,IAAAA,CAAC,CAACU,wBAAF,GAA6Bb,KAAK,CAACsB,SAAnC;AACD;;AAED,MAAIrB,cAAJ,EAAoB;AAClBE,IAAAA,CAAC,CAACF,cAAF,GAAmBA,cAAc,CAACM,EAAlC;AACD;;AAED,MAAIP,KAAK,CAACmC,IAAV,EAAgB;AACdhC,IAAAA,CAAC,CAACgC,IAAF,GAASnC,KAAK,CAACmC,IAAN,CAAW5B,EAApB;AACD;;AAED,SAAOJ,CAAP;AACD;AAEM,SAASiC,eAAT,CAAyBC,MAAzB,EAAiC;AACtC,SAAOA,MAAM,CAAC1B,GAAP,CAAYX,KAAD,IAAWD,cAAc,CAACC,KAAD,CAApC,CAAP;AACD;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASsC,2BAAT,CAAqCC,IAArC,EAA2C;AAChD,QAAM;AAAChC,IAAAA,EAAE,EAAEE;AAAL,MAAiB8B,IAAvB;AACA,QAAM;AAAChC,IAAAA,EAAD;AAAKiC,IAAAA;AAAL,MAAgBC,kBAAkB,CAAChC,QAAD,CAAxC;AACA,QAAM0B,IAAI,GAAGI,IAAI,CAACG,MAAL,GAAc;AAACnC,IAAAA,EAAE,EAAEkC,kBAAkB,CAACF,IAAI,CAACG,MAAN,CAAlB,CAAgCnC;AAArC,GAAd,GAAyD,EAAtE;AACA,QAAMU,IAAI,GAAGsB,IAAI,CAACtB,IAAL,KAAc,QAAd,GAAyBG,qBAAzB,GAAiDC,gBAA9D;AACA,QAAMH,IAAI,GAAGqB,IAAI,CAACd,QAAL,GAAgB,CAAClC,UAAD,CAAhB,GAA+B,EAA5C;AAEA,SAAO;AACLgB,IAAAA,EADK;AAELiC,IAAAA,OAFK;AAGL/B,IAAAA,QAHK;AAILQ,IAAAA,IAJK;AAKLkB,IAAAA,IALK;AAMLjB,IAAAA,IANK;AAOLb,IAAAA,WAAW,EAAEkC,IAAI,CAACI,KAPb;AAQL9B,IAAAA,wBAAwB,EAAE0B,IAAI,CAACK,YAR1B;AASLrB,IAAAA,YAAY,EAAE,KATT;AAULrB,IAAAA,UAAU,EAAE;AACVT,MAAAA,KAAK,EAAE;AADG,KAVP;AAaLuB,IAAAA,YAAY,EAAE;AACZvB,MAAAA,KAAK,EAAE;AADK;AAbT,GAAP;AAiBD;;MCnGYoD,YAAY,GAAG;MACfC,0BAA0B,GAAG;MAC7BC,iBAAiB,GAAG;MACpBC,cAAc,GAAG;MACjBC,iBAAiB,GAAG;MACpBC,YAAY,GAAG;MACfC,WAAW,GAAG;MACdC,mBAAmB,GAAG;;AAGnC,MAAMC,yBAAyB,GAAG;AAChCC,EAAAA,aAAa,EAAE,KADiB;AAEhCC,EAAAA,iBAAiB,EAAE,CAFa;AAGhCC,EAAAA,eAAe,EAAE,CAHe;AAIhCC,EAAAA,mBAAmB,EAAE,IAJW;AAKhChD,EAAAA,QAAQ,EAAE,IALsB;AAMhCiD,EAAAA,QAAQ,EAAE;AANsB,CAAlC;AASA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,eAAT,CAAyBC,OAAzB,EAAkCC,YAAlC,EAAgD;AACrD,SAAO;AACL5C,IAAAA,IAAI,EAAE8B,iBADD;AAELe,IAAAA,OAAO,EAAE;AACPD,MAAAA,YADO;AAEPD,MAAAA;AAFO;AAFJ,GAAP;AAOD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASG,YAAT,CAAsBH,OAAtB,EAA+B1C,IAA/B,EAAqC;AAC1C,SAAO;AACLD,IAAAA,IAAI,EAAE+B,cADD;AAELc,IAAAA,OAAO,EAAE;AACPF,MAAAA,OADO;AAEP1C,MAAAA;AAFO;AAFJ,GAAP;AAOD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS8C,eAAT,CAAyBJ,OAAzB,EAAkC1C,IAAlC,EAAwC;AAC7C,SAAO;AACLD,IAAAA,IAAI,EAAEgC,iBADD;AAELa,IAAAA,OAAO,EAAE;AACPF,MAAAA,OADO;AAEP1C,MAAAA;AAFO;AAFJ,GAAP;AAOD;AAEM,SAAS+C,WAAT,CAAqB1D,EAArB,EAAyB;AAC9B,SAAO;AACLU,IAAAA,IAAI,EAAEiC,YADD;AAELY,IAAAA,OAAO,EAAE;AACPvD,MAAAA;AADO;AAFJ,GAAP;AAMD;AAGM,SAAS2D,WAAT,CAAqB7B,MAArB,EAA6B;AAClC,SAAO;AACLpB,IAAAA,IAAI,EAAE4B,YADD;AAELiB,IAAAA,OAAO,EAAE;AACPzB,MAAAA,MAAM,EAAED,eAAe,CAACC,MAAD;AADhB;AAFJ,GAAP;AAMD;;AAED,SAAS8B,iBAAT,CAA2B5D,EAA3B,EAA+B;AAC7B,SAAO;AACLU,IAAAA,IAAI,EAAEmC,mBADD;AAELU,IAAAA,OAAO,EAAE;AACPvD,MAAAA;AADO;AAFJ,GAAP;AAMD;AAED;AACA;AACA;AACA;AACA;;;AACA,SAAS6D,YAAT,CAAsBC,QAAtB,EAAgCC,IAAhC,EAAsC;AACpCD,EAAAA,QAAQ,CAACE,QAAQ,CAAC;AAChBC,IAAAA,IAAI,EAAEF,IADU;AAEhB/D,IAAAA,EAAE,EAAE,0BAFY;AAGhBkE,IAAAA,YAAY,EAAE,wBAHE;AAIhBC,IAAAA,eAAe,EAAG,mDAAkDJ,IAAK,GAJzD;AAKhBK,IAAAA,SAAS,EAAE;AALK,GAAD,CAAT,CAAR;AAOD;;AAED,SAASC,YAAT,CAAsB5E,KAAtB,EAA6B;AAC3B,MAAI,OAAOA,KAAK,CAAC6E,OAAb,KAAyB,UAA7B,EAAyC;AACvC,WAAO7E,KAAK,CAAC6E,OAAN,GACJC,IADI,CACE3E,CAAD,IAAO4E,OAAO,CAACC,OAAR,CAAgB7E,CAAhB,CADR,CAAP;AAED;;AAED,SAAO4E,OAAO,CAACC,OAAR,CAAgB,IAAIC,KAAJ,CAAU,2BAAV,CAAhB,CAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASC,uBAAT,CAAiCC,QAAjC,EAA2CC,MAA3C,EAAmDC,UAAU,GAAG,KAAhE,EAAuE;AAC5E;AACA,QAAMrF,KAAK,GAAG;AACZO,IAAAA,EAAE,EAAE4E,QAAQ,CAACG,MAAT,CAAgB/E,EADR;AAEZN,IAAAA,cAAc,EAAEkF,QAAQ,CAAC5E,EAFb;AAGZkB,IAAAA,QAAQ,EAAE0D,QAAQ,CAACI,MAAT,CAAgBrE,IAAhB,IAAwBiE,QAAQ,CAACI,MAAT,CAAgBrE,IAAhB,CAAqBC,QAArB,CAA8B5B,UAA9B;AAHtB,GAAd;;AAMA,MAAI6F,MAAJ,EAAY;AACVpF,IAAAA,KAAK,CAACc,oBAAN,GAA6BqE,QAAQ,CAAC7D,SAAtC;AACD;;AAED,MAAI+D,UAAJ,EAAgB;AACdrF,IAAAA,KAAK,CAACa,wBAAN,GAAiCsE,QAAQ,CAAC7D,SAA1C;AACD;;AAED,SAAO;AACLL,IAAAA,IAAI,EAAE6B,0BADD;AAELgB,IAAAA,OAAO,EAAE;AACP9D,MAAAA;AADO;AAFJ,GAAP;AAMD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASwF,UAAT,CAAoBC,aAApB,EAAmCzF,KAAnC,EAA0C;AAC/C,SAAQqE,QAAD,IAAc;AACnBA,IAAAA,QAAQ,CAACF,iBAAiB,CAACnE,KAAK,CAACO,EAAP,CAAlB,CAAR,CADmB;AAGnB;AACA;;AACA8D,IAAAA,QAAQ,CAACqB,uBAAuB,EAAxB,CAAR;AAEA,WAAOD,aAAa,CAACE,QAAd,CAAuBC,YAAvB,CAAoCC,GAApC,CAAwC7F,KAAxC,EAA+C;AACpDwD,MAAAA,eAAe,EAAE,EADmC;AAEpDD,MAAAA,iBAAiB,EAAE,CAAC,CAFgC;AAGpDuC,MAAAA,oBAAoB,EAAE,KAH8B;AAIpDC,MAAAA,mBAAmB,EAAE,IAJ+B;AAKpDtF,MAAAA,QAAQ,EAAE,IAL0C;AAMpDR,MAAAA,cAAc,EAAE;AANoC,KAA/C,EAQJ6E,IARI,CAQEkB,SAAD,IAAe;AACnB3B,MAAAA,QAAQ,CAAC4B,UAAU,CAACD,SAAS,CAAChF,YAAV,CAAuBvB,KAAxB,CAAX,CAAR;AACA4E,MAAAA,QAAQ,CAAC6B,eAAe,CAACF,SAAS,CAAC9F,UAAV,CAAqBT,KAAtB,CAAhB,CAAR;AACA4E,MAAAA,QAAQ,CAACH,WAAW,CAAC,CAAC8B,SAAD,CAAD,CAAZ,CAAR,CAHmB;AAMnB;AACA;AACA;;AACA3B,MAAAA,QAAQ,CAAC8B,iBAAiB,CACxBC,qBAAqB,CAACJ,SAAD,EAAYP,aAAZ,CADG,CAAlB,CAAR;AAIA,aAAOV,OAAO,CAACC,OAAR,CAAgBjF,cAAc,CAACiG,SAAD,CAA9B,CAAP;AACD,KAtBI,EAuBJK,KAvBI,CAuBGC,GAAD,IAAS;AACdlC,MAAAA,YAAY,CAACC,QAAD,EAAWiC,GAAG,CAAChC,IAAf,CAAZ;AAEA,YAAOgC,GAAP;AACD,KA3BI,CAAP;AA4BD,GAnCD;AAoCD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,oBAAT,CAA8Bd,aAA9B,EAA6Ce,OAAO,GAAG,EAAvD,EAA2D;AAChE,QAAMC,WAAW,GAAGC,MAAM,CAACC,MAAP,CAAc;AAACC,IAAAA,YAAY,EAAE;AAAf,GAAd,EAAoCvD,yBAApC,EAA+DmD,OAA/D,CAApB;AAEA,SAAQnC,QAAD,IAAcoB,aAAa,CAACE,QAAd,CAAuBC,YAAvB,CAClBiB,IADkB,CACbJ,WADa,EAElB3B,IAFkB,CAEZrF,KAAD,IAAW;AACf,UAAM4C,MAAM,GAAG5C,KAAK,CAACkB,GAAN,CAAWX,KAAD,IAAW;AAClC,YAAM8G,cAAc,GAAGlC,YAAY,CAAC5E,KAAD,CAAZ,CACpB8E,IADoB,CACdiC,cAAD,IAAoB;AACxB,YAAIA,cAAJ,EAAoB;AAClB,gBAAM5G,CAAC,GAAGuG,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBI,cAAlB,EAAkC;AAACxF,YAAAA,YAAY,EAAE;AAAf,WAAlC,CAAV;AAEA8C,UAAAA,QAAQ,CAACH,WAAW,CAAC,CAAC/D,CAAD,CAAD,CAAZ,CAAR;AAEA,iBAAO4E,OAAO,CAACC,OAAR,CAAgBjF,cAAc,CAACI,CAAD,CAA9B,CAAP;AACD;;AAED,eAAO4E,OAAO,CAACC,OAAR,CAAgB,IAAIC,KAAJ,CAAU,mCAAV,CAAhB,CAAP;AACD,OAXoB,CAAvB;AAaA,aAAOyB,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB3G,KAAlB,EAAyB;AAC9BuB,QAAAA,YAAY,EAAE,IADgB;AAE9BuF,QAAAA;AAF8B,OAAzB,CAAP;AAID,KAlBc,CAAf;AAoBAzC,IAAAA,QAAQ,CAACH,WAAW,CAAC7B,MAAD,CAAZ,CAAR;AAEA,WAAO0C,OAAO,CAACC,OAAR,CAAgB3C,MAAhB,CAAP;AACD,GA1BkB,EA2BlBgE,KA3BkB,CA2BXC,GAAD,IAAS;AACdlC,IAAAA,YAAY,CAACC,QAAD,EAAWiC,GAAG,CAAChC,IAAf,CAAZ;AAEA,UAAOgC,GAAP;AACD,GA/BkB,CAArB;AAgCD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASU,WAAT,CAAqBvB,aAArB,EAAoCe,OAAO,GAAG,EAA9C,EAAkD;AACvD,QAAMC,WAAW,GAAGC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBtD,yBAAlB,EAA6CmD,OAA7C,CAApB;AAEA,SAAQnC,QAAD,IAAcoB,aAAa,CAACE,QAAd,CAAuBC,YAAvB,CAClBiB,IADkB,CACbJ,WADa,EAElB3B,IAFkB,CAEZzC,MAAD,IAAY;AAChBgC,IAAAA,QAAQ,CAACH,WAAW,CAAC7B,MAAD,CAAZ,CAAR;AAEA,UAAM4E,iBAAiB,GAAG5E,MAAM,CAAC1B,GAAP,CAAWZ,cAAX,CAA1B;AAEA,WAAOgF,OAAO,CAACC,OAAR,CAAgBiC,iBAAhB,CAAP;AACD,GARkB,EASlBZ,KATkB,CASXC,GAAD,IAAS;AACdlC,IAAAA,YAAY,CAACC,QAAD,EAAWiC,GAAG,CAAChC,IAAf,CAAZ;AAEA,UAAOgC,GAAP;AACD,GAbkB,CAArB;AAcD;AAEM,SAASY,gBAAT,CAA0BzB,aAA1B,EAAyCe,OAAO,GAAG,EAAnD,EAAuD;AAC5D,QAAMW,mBAAmB,GAAG;AAC1BC,IAAAA,GAAG,EAAE,GADqB;AAE1BC,IAAAA,MAAM,EAAE;AAFkB,GAA5B;AAKA,QAAMZ,WAAW,GAAGC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBQ,mBAAlB,EAAuCX,OAAvC,CAApB;AAEA,SAAQnC,QAAD,IAAcoB,aAAa,CAAC6B,KAAd,CAClBT,IADkB,CACbJ,WADa,EAElB3B,IAFkB,CAEZwC,KAAD,IAAW;AACf,UAAMjF,MAAM,GAAGiF,KAAK,CAAC7H,KAAN,CAAYkB,GAAZ,CAAgB2B,2BAAhB,CAAf;AAEA+B,IAAAA,QAAQ,CAACH,WAAW,CAAC7B,MAAD,CAAZ,CAAR;AAEA,UAAM4E,iBAAiB,GAAG5E,MAAM,CAAC1B,GAAP,CAAWZ,cAAX,CAA1B;AAEA,WAAOgF,OAAO,CAACC,OAAR,CAAgBiC,iBAAhB,CAAP;AACD,GAVkB,EAWlBZ,KAXkB,CAWXC,GAAD,IAAS;AACdlC,IAAAA,YAAY,CAACC,QAAD,EAAWiC,GAAG,CAAChC,IAAf,CAAZ;AAEA,UAAOgC,GAAP;AACD,GAfkB,CAArB;AAgBD;;AC7SM,MAAMiB,KAAK,GAAGC,MAAM,CAAC;AAC1BvH,EAAAA,cAAc,EAAE,IADU;AAE1BG,EAAAA,MAAM,EAAE,EAFkB;AAG1BC,EAAAA,WAAW,EAAE,EAHa;AAI1BE,EAAAA,EAAE,EAAE,IAJsB;AAK1BE,EAAAA,QAAQ,EAAE,IALgB;AAM1BD,EAAAA,GAAG,EAAE,EANqB;AAO1BE,EAAAA,QAAQ,EAAE,EAPgB;AAQ1BR,EAAAA,UAAU,EAAE,EARc;AAS1BW,EAAAA,wBAAwB,EAAE,EATA;AAU1BC,EAAAA,oBAAoB,EAAE,EAVI;AAW1B2G,EAAAA,qBAAqB,EAAE,EAXG;AAY1B1G,EAAAA,kBAAkB,EAAE,EAZM;AAa1BC,EAAAA,YAAY,EAAE,EAbY;AAc1BC,EAAAA,IAAI,EAAE,EAdoB;AAe1BK,EAAAA,SAAS,EAAE,EAfe;AAgB1BJ,EAAAA,IAAI,EAAE,EAhBoB;AAiB1BiB,EAAAA,IAAI,EAAE,IAjBoB;AAkB1BZ,EAAAA,YAAY,EAAE,KAlBY;AAmB1BE,EAAAA,QAAQ,EAAE,KAnBgB;AAoB1BD,EAAAA,QAAQ,EAAE,KApBgB;AAqB1BkG,EAAAA,UAAU,EAAE;AArBc,CAAD,CAApB;MAwBMC,YAAY,GAAGC,MAAM,CAAC;AACjCC,EAAAA,IAAI,EAAE;AAD2B,CAAD;AAKnB,SAASC,OAAT,CAAiBC,KAAK,GAAGJ,YAAzB,EAAuCK,MAAvC,EAA+C;AAC5D,UAAQA,MAAM,CAAC/G,IAAf;AACE,SAAK+B,cAAL;AAAqB;AACnB,cAAM;AAACY,UAAAA,OAAD;AAAU1C,UAAAA;AAAV,YAAkB8G,MAAM,CAAClE,OAA/B;;AAEA,YAAIiE,KAAK,CAACE,KAAN,CAAY,CAAC,MAAD,EAASrE,OAAT,CAAZ,CAAJ,EAAoC;AAClC,gBAAMsE,YAAY,GAAGH,KAAK,CAACI,KAAN,CAAY,CAAC,MAAD,EAASvE,OAAT,EAAkB,MAAlB,CAAZ,CAArB;AAEA,iBAAOmE,KAAK,CAACK,KAAN,CAAY,CAAC,MAAD,EAASxE,OAAT,EAAkB,MAAlB,CAAZ,EAAuCyE,KAAK,CAACH,YAAD,EAAehH,IAAf,CAA5C,CAAP;AACD;;AAED,eAAO6G,KAAP;AACD;;AAED,SAAK7E,YAAL;AACE,aAAO6E,KAAK,CAACO,QAAN,CAAe,CAAC,MAAD,EAASN,MAAM,CAAClE,OAAP,CAAevD,EAAxB,CAAf,CAAP;;AAEF,SAAK0C,iBAAL;AAAwB;AACtB,cAAM;AAACW,UAAAA,OAAD;AAAU1C,UAAAA;AAAV,YAAkB8G,MAAM,CAAClE,OAA/B;;AAEA,YAAIiE,KAAK,CAACE,KAAN,CAAY,CAAC,MAAD,EAASrE,OAAT,CAAZ,CAAJ,EAAoC;AAClC,gBAAM2E,YAAY,GAAGR,KAAK,CAACI,KAAN,CAAY,CAAC,MAAD,EAASvE,OAAT,EAAkB,MAAlB,CAAZ,CAArB;AAEA1C,UAAAA,IAAI,CAACsH,OAAL,CAAcC,CAAD,IAAO;AAClB,kBAAMC,KAAK,GAAGH,YAAY,CAAC1I,OAAb,CAAqB4I,CAArB,CAAd;;AAEA,gBAAIC,KAAK,KAAK,CAAC,CAAf,EAAkB;AAChBH,cAAAA,YAAY,CAACI,MAAb,CAAoBD,KAApB,EAA2B,CAA3B;AACD;AACF,WAND;AAQA,iBAAOX,KAAK,CAACK,KAAN,CAAY,CAAC,MAAD,EAASxE,OAAT,EAAkB,MAAlB,CAAZ,EAAuC2E,YAAvC,CAAP;AACD;;AAED,eAAOR,KAAP;AACD;;AAED,SAAK3E,mBAAL;AAA0B;AACxB,cAAM;AAAC7C,UAAAA;AAAD,YAAOyH,MAAM,CAAClE,OAApB;AAEA,eAAOiE,KAAK,CAACK,KAAN,CAAY,CAAC,MAAD,EAAS7H,EAAT,CAAZ,EAA0B,IAAIgH,KAAJ,CAAU;AACzChH,UAAAA,EADyC;AAEzCmH,UAAAA,UAAU,EAAE;AAF6B,SAAV,CAA1B,CAAP;AAID;;AAED,SAAK7E,YAAL;AAAmB;AACjB,cAAMR,MAAM,GAAG,EAAf;AAEA2F,QAAAA,MAAM,CAAClE,OAAP,CAAezB,MAAf,CAAsBmG,OAAtB,CAA+BrI,CAAD,IAAO;AACnCkC,UAAAA,MAAM,CAAClC,CAAC,CAACI,EAAH,CAAN,GAAe,IAAIgH,KAAJ,CAAUpH,CAAV,CAAf;AACD,SAFD;AAIA,eAAO4H,KAAK,CAACa,WAAN,CAAkB,CAAC,MAAD,CAAlB,EAA4BvG,MAA5B,CAAP;AACD;;AAED,SAAKS,0BAAL;AAAiC;AAC/B,cAAM;AAAC9C,UAAAA;AAAD,YAAUgI,MAAM,CAAClE,OAAvB;;AAEA,YAAIiE,KAAK,CAACE,KAAN,CAAY,CAAC,MAAD,EAASjI,KAAK,CAACO,EAAf,CAAZ,CAAJ,EAAqC;AACnC,iBAAOwH,KAAK,CAACa,WAAN,CAAkB,CAAC,MAAD,EAAS5I,KAAK,CAACO,EAAf,CAAlB,EAAsCP,KAAtC,CAAP;AACD;;AAED,eAAO+H,KAAP;AACD;;AAED,SAAKhF,iBAAL;AAAwB;AACtB,cAAM;AAACc,UAAAA,YAAD;AAAeD,UAAAA;AAAf,YAA0BoE,MAAM,CAAClE,OAAvC;AAEA,eAAOiE,KAAK,CAACK,KAAN,CAAY,CAAC,MAAD,EAASxE,OAAT,EAAkB,sBAAlB,CAAZ,EAAuDC,YAAvD,CAAP;AACD;;AAED;AACE,aAAOkE,KAAP;AAxEJ;AA0ED;;;;;"}